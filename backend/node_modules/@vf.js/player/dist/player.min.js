/*!
 * player.min.js 
 *  Compiled Mon Sep 13 2021 17:39:43 GMT+0800 (China Standard Time) 
 *  https://yunkc.gitee.io/docs/
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["vf.player"]=e():t["vf.player"]=e()}(window,(function(){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var o,r,i={};n.r(i),n.d(i,"BoardDrawPlug",(function(){return tn})),n.d(i,"SliderEditorPlug",(function(){return nn})),n.d(i,"DigitalLibraryPlug",(function(){return rn})),n.d(i,"PlugIndex",(function(){return an})),function(t){t[t.CONST=0]="CONST",t[t.VARIABLE=1]="VARIABLE",t[t.RANDOM=2]="RANDOM",t[t.STSTEN=3]="STSTEN",t[t.PROPERTY=4]="PROPERTY",t[t.OPERATION=5]="OPERATION",t[t.ARRAY_LEN=6]="ARRAY_LEN",t[t.ARRAY_VALUE=7]="ARRAY_VALUE",t[t.OBJECT_VALUE=8]="OBJECT_VALUE",t[t.PARAM_VALUE=9]="PARAM_VALUE",t[t.ARRAY_FUNCTION=10]="ARRAY_FUNCTION",t[t.COMPONENT=11]="COMPONENT",t[t.STRING_FUNCTION=12]="STRING_FUNCTION",t[t.PARSE_INT=13]="PARSE_INT",t[t.PARSE_FLOAT=14]="PARSE_FLOAT"}(o||(o={})),function(t){t[t.TIME=0]="TIME",t[t.YEAR=1]="YEAR",t[t.MONTH=2]="MONTH",t[t.DAY=3]="DAY",t[t.DATE=4]="DATE",t[t.HOUR=5]="HOUR",t[t.MINUTE=6]="MINUTE",t[t.SECOND=7]="SECOND",t[t.MILLISECOND=8]="MILLISECOND"}(r||(r={}));var a,s,c=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});!function(t){t.EVENT_RUN="EVENT_RUN",t.EVENT_COMPLETE="EVENT_COMPLETE",t.EVENT_FAIL="EVENT_FAIL",t.EVENT_BREAK="EVENT_BREAK",t.FUNCTION_RUN_COMPLETE="FUNCTION_RUN_COMPLETE"}(s||(s={}));var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._isRunning=!1,e._isPaused=!1,e._isCompleted=!1,e._isFailed=!1,e._synchronous=!1,e}return c(e,t),e.prototype.run=function(){this._isRunning=!0,this._isCompleted=!1,this._isFailed=!1,this.emit(s.EVENT_RUN,this)},e.prototype.stop=function(){this._isRunning=!1},e.prototype.pause=function(){this._isPaused=!0},e.prototype.resume=function(){this._isPaused=!1},e.prototype.break=function(){this._isRunning=!1,this.emit(s.EVENT_BREAK,this)},e.prototype.complete=function(){this._isRunning=!1,this._isCompleted=!0,this.emit(s.EVENT_COMPLETE,this)},e.prototype.fail=function(t,e){void 0===e&&(e=null),this._isRunning=!1,this._isFailed=!0,this.emit(s.EVENT_FAIL,e)},Object.defineProperty(e.prototype,"synchronous",{get:function(){return this._synchronous},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isRunning",{get:function(){return this._isRunning},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCompleted",{get:function(){return this._isCompleted},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isFailed",{get:function(){return this._isFailed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPaused",{get:function(){return this._isPaused},enumerable:!1,configurable:!0}),e}(vf.utils.EventEmitter),u=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._tasks=[],e._currentTask=null,e._curTaskIndex=0,e}return u(e,t),Object.defineProperty(e.prototype,"tasks",{get:function(){return this._tasks},enumerable:!1,configurable:!0}),e.prototype.run=function(){this.isRunning||(this._curTaskIndex=0,t.prototype.run.call(this),this._execute())},e.prototype.stop=function(){t.prototype.stop.call(this),this._currentTask&&(this.clearEvent(this._currentTask),this._currentTask=null),this._tasks.forEach((function(t){t&&t.stop()})),this._curTaskIndex=Number.MAX_VALUE,this.off(s.EVENT_COMPLETE),this.off(s.EVENT_BREAK),this.off(s.EVENT_FAIL),this.complete()},e.prototype.pause=function(){t.prototype.pause.call(this),this._tasks.forEach((function(t){t.pause()}))},e.prototype.resume=function(){t.prototype.resume.call(this),this._tasks.forEach((function(t){t.resume()}))},e.prototype.break=function(){t.prototype.break.call(this),this._currentTask&&(this.clearEvent(this._currentTask),this._currentTask.break(),this._currentTask=null),this._curTaskIndex=Number.MAX_VALUE,this.off(s.EVENT_COMPLETE),this.off(s.EVENT_BREAK),this.off(s.EVENT_FAIL),this.complete()},e.prototype.addTask=function(t){if(!t)throw new Error("ArgumentError");if(!(this._tasks.indexOf(t)<0))throw new Error("duplicate task");return this._tasks.push(t),t},e.prototype._execute=function(){var t;this._curTaskIndex<this._tasks.length&&(t=this._tasks[this._curTaskIndex]),t?(this._currentTask=t,this._currentTask.on(s.EVENT_COMPLETE,this.onOneTaskComplete,this),this._currentTask.on(s.EVENT_FAIL,this.onOneTaskFail,this),this._currentTask.on(s.EVENT_BREAK,this.onOneTaskBreak,this),this._currentTask.run()):this.complete()},e.prototype.clearEvent=function(t){t&&(t.off(s.EVENT_COMPLETE,this.onOneTaskComplete,this),t.off(s.EVENT_FAIL,this.onOneTaskFail,this),t.off(s.EVENT_BREAK,this.onOneTaskBreak,this))},e.prototype.onOneTaskBreak=function(){this._currentTask&&(this.clearEvent(this._currentTask),this.emit(s.EVENT_BREAK),this.complete())},e.prototype.onOneTaskFail=function(t){if(!this._currentTask)throw new Error("no task");this.clearEvent(this._currentTask),this.fail(t.type,t.data)},e.prototype.onOneTaskComplete=function(){this.nextTask()},e.prototype.getNextTask=function(){return this._tasks[this._curTaskIndex+1]},e.prototype.nextTask=function(){this.clearEvent(this._currentTask),this._curTaskIndex++,this._execute()},e}(p),h=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),f=function(t){function e(){var e=t.call(this)||this;return e.loopTask=new l,e.loopTask.on(s.EVENT_BREAK,e.onBreak,e),e}return h(e,t),e.prototype.addSubTask=function(t){this.loopTask&&this.loopTask.addTask(t)},e.prototype.stop=function(){t.prototype.stop.call(this),this.loopTask&&(this.loopTask.off(s.EVENT_BREAK),this.loopTask.stop())},e.prototype.break=function(){t.prototype.break.call(this),this.loopTask&&(this.loopTask.off(s.EVENT_BREAK),this.loopTask.break())},e.prototype.pause=function(){t.prototype.pause.call(this),this.loopTask&&this.loopTask.pause()},e.prototype.resume=function(){t.prototype.resume.call(this),this.loopTask&&this.loopTask.resume()},e.prototype.onBreak=function(t){this.break()},e}(p),m=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=function(t){function e(e){var n=t.call(this)||this;return n.name=e,n}return m(e,t),e.prototype.exec=function(){this.loopTask&&(this.loopTask.on(s.EVENT_COMPLETE,this.onLoopComplete,this),this.loopTask.on(s.EVENT_FAIL,this.onLoopComplete,this),this.loopTask.run())},e.prototype.onLoopComplete=function(){this.complete()},e}(f),v=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),y=function(t){function e(){var n=t.call(this)||this;return n.hashCode=++e.maxHashCode,n.libId="0",n.id="0",n.childrenMap={},n.interactabled=!1,n}return v(e,t),Object.defineProperty(e.prototype,"vfStage",{get:function(){return this._vfStage},set:function(t){for(var n in this._vfStage=t,this.childrenMap)if(this.childrenMap[n]){var o=this.childrenMap[n];o instanceof e&&(o.vfStage=t)}},enumerable:!1,configurable:!0}),e.prototype.pause=function(){for(var t in this.childrenMap)if(this.childrenMap[t]){var n=this.childrenMap[t];n instanceof e&&n.pause()}this.animation&&this.animation.pause(),this.actionList&&this.actionList.pause()},e.prototype.resume=function(){for(var t in this.childrenMap)if(this.childrenMap[t]){var n=this.childrenMap[t];n instanceof e&&n.resume()}this.animation&&this.animation.resume(),this.actionList&&this.actionList.resume()},e.prototype.playDefaultAnimation=function(){this.animation&&this.animation.playDefaultAnimation()},e.prototype.gotoPlay=function(t,e,n,o){void 0===n&&(n=1),void 0===o&&(o=0),this.animation&&this.animation.gotoPlay(t,e,n,o)},e.prototype.gotoStop=function(t,e){this.animation&&this.animation.gotoStop(t,e)},e.prototype.gotoEnd=function(t,e){void 0===e&&(e=0),this.animation&&this.animation.gotoEnd(t,e)},e.prototype.gotoByTimeline=function(t,e){this.animation&&this.animation.gotoByTimeline(t,e)},e.prototype.stopByTimeline=function(){this.stop()},e.prototype.play=function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=0),this.animation&&this.animation.play(t,e,n)},e.prototype.playMulit=function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=0),this.animation&&this.animation.playMulit(t,e,n)},e.prototype.execCustomActionByName=function(t){if(this.actionList)for(var e=0,n=this.actionList.actionList;e<n.length;e++){var o=n[e];o instanceof d&&o.name===t&&o.exec()}},e.prototype.stop=function(){for(var t in this.childrenMap)if(this.childrenMap[t]){var n=this.childrenMap[t];n instanceof e&&n.stop()}this.animation&&this.animation.stop(),this.actionList&&this.actionList.stop()},e.prototype.stopSelf=function(){this.animation&&this.animation.stop(),this.actionList&&this.actionList.stop()},e.prototype.stopAnimation=function(){for(var t in this.childrenMap)if(this.childrenMap[t]){var n=this.childrenMap[t];n instanceof e&&n.stopAnimation()}this.animation&&this.animation.stop()},e.prototype.stopSelfAnimation=function(){this.animation&&this.animation.stop()},e.prototype.getChildById=function(t){return this.childrenMap[t]},e.prototype.getVariable=function(t){if(this._vfStage)return this._vfStage.variableManager.getVariable(this.hashCode.toString(),t)},e.prototype.getVariableValue=function(t){var e=this.getVariable(t);if(e)return e.value},e.prototype.setVariableValue=function(t,e){var n=this.getVariable(t);n&&(n.value=e)},e.prototype.addChildAt=function(n,o){var r=n.id;this.childrenMap[r.toString()]||(this.childrenMap[r.toString()]=n),n instanceof e&&(n.vfStage=this.vfStage);var i=t.prototype.addChildAt.call(this,n,o);return n instanceof e&&n.playDefaultAnimation(),i},e.prototype.removeChild=function(e){e.id;return t.prototype.removeChild.call(this,e)},e.prototype.runAction=function(){for(var t in this.childrenMap)if(this.childrenMap[t]){var n=this.childrenMap[t];n instanceof e&&n.runAction()}this.actionList&&this.actionList.run(),this.on("Remove",this.onRemoved,this)},e.prototype.emitAddToChildBefore=function(){for(var t in this.childrenMap)if(this.childrenMap[t]){var n=this.childrenMap[t];n instanceof e&&n.emitAddToChildBefore()}this.emit("Add",this)},e.prototype.emitAddToChild=function(){for(var t in this.childrenMap)if(this.childrenMap[t]){var n=this.childrenMap[t];n instanceof e&&n.emitAddToChild()}if(this.scripts)for(var o=0,r=this.scripts;o<r.length;o++){r[o].start()}this.emit("Added",this)},e.prototype.emitRemoveToChild=function(){for(var t in this.childrenMap)if(this.childrenMap[t]){var n=this.childrenMap[t];n instanceof e&&n.emitRemoveToChild()}this.emit("Removed",this)},e.prototype.emitRemoveToChildBefore=function(){for(var t in this.childrenMap)if(this.childrenMap[t]){var n=this.childrenMap[t];n instanceof e&&n.emitRemoveToChildBefore()}if(this.scripts)for(var o=0,r=this.scripts;o<r.length;o++){r[o].stop()}this.emit("Remove",this)},e.prototype.dispose=function(){for(var t in this.interactabled=!1,this.childrenMap)if(this.childrenMap[t]){var n=this.childrenMap[t];n instanceof e&&n.dispose()}this.stopSelf(),this.onRemoved(),this._vfStage=void 0,this.releaseAll()},e.prototype.onRemoved=function(){this.off("Remove")},e.maxHashCode=1e4,e}(vf.gui.ScrollingContainer),g=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),_=function(t){function e(n,o,r){return t.call(this,n||e.vertexSrc,o,r||e.crossFadeUniforms)||this}return g(e,t),e.prototype.apply=function(t,e,n){var o=new vf.Matrix;t.calculateNormalizedScreenSpaceMatrix(o),this.uniforms.filterMatrix=o,this.uniforms.resolution=vf.settings.RESOLUTION,t.applyFilter(this,e,n,void 0)},e.prototype.setPreviousTexture=function(t){this.uniforms.previousTexture=t},Object.defineProperty(e.prototype,"progress",{get:function(){return this.uniforms.progress},set:function(t){t=Math.min(1,t),t=Math.max(0,t),this.uniforms.progress=t},enumerable:!1,configurable:!0}),e.prototype.applyTranisition=function(t){this.target=t,this.target.filters=[this]},e.prototype.dispose=function(){this.target&&(this.target.filters=[])},e.vertexSrc="\n            precision highp float;\n            \n            attribute vec2 aVertexPosition;\n            attribute vec2 aTextureCoord;\n            attribute vec4 aColor;\n            \n            uniform mat3 projectionMatrix;\n            uniform mat3 filterMatrix;\n            uniform vec4 inputSize;\n            uniform vec4 outputFrame;\n            uniform float resolution;\n            \n            varying vec2 vTextureCoord;\n            varying vec2 vFilterCoord;\n            \n            void main(void){\n                gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n                // filterMatrix.xy = ((vTextureCoord * inputSize.xy) + outputFrame.xy) / outputFrame.zw;\n                vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy / resolution;\n                // vFilterCoord = (((vTextureCoord * inputSize.xy) + outputFrame.xy) / outputFrame.zw) * aTextureCoord / resolution;\n                vTextureCoord = aTextureCoord ;\n            }\n        ",e.crossFadeUniforms={filterMatrix:vf.Matrix.TEMP_MATRIX,resolution:vf.settings.RESOLUTION,previousTexture:null,progress:0},e}(vf.Filter),b=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),T=function(t){function e(){return t.call(this,"",e.fragmentSrc)||this}return b(e,t),e.fragmentSrc="\n            precision mediump float;\n            uniform sampler2D uSampler;\n            uniform sampler2D previousTexture;\n            uniform float progress;\n\n            uniform highp vec4 inputSize;\n            uniform highp vec4 outputFrame;\n\n            varying vec2 vFilterCoord;\n            varying vec2 vTextureCoord;\n\n            void main()\n            {\n                float m = outputFrame.z / 2000.0;\n                float t = inputSize.y / inputSize.x;\n                vec2 circle = vFilterCoord - 0.5;\n                circle.y = circle.y * t;\n                float d = length(circle);\n                float p2 = progress * progress;\n                if(d > p2) {\n                    gl_FragColor = texture2D(previousTexture, vFilterCoord);\n                } else {\n                    gl_FragColor = texture2D(uSampler, vTextureCoord);\n                }\n                gl_FragColor = vec4(m, 0.0, 0.0, 1.0);\n            }\n        ",e}(_),E=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),O=function(t){function e(){return t.call(this,_.vertexSrc,e.fragmentSrc,e.linearBlurUniforms)||this}return E(e,t),e.linearBlurUniforms={filterMatrix:vf.Matrix.TEMP_MATRIX,resolution:vf.settings.RESOLUTION,previousTexture:null,progress:0,strength:.4},e.fragmentSrc="\n            #ifdef GL_ES\n            precision highp float;\n            #endif\n            uniform sampler2D uSampler;\n            uniform sampler2D previousTexture;\n            uniform float progress;\n            uniform float resolution;\n            uniform float strength;\n            \n            varying vec2 vTextureCoord;\n            varying vec2 vFilterCoord;\n            \n            const float PI = 3.141592653589793;\n            \n            float Linear_ease(in float begin, in float change, in float duration, in float time) {\n                return change * time / duration + begin;\n            }\n            \n            float Exponential_easeInOut(in float begin, in float change, in float duration, in float time) {\n                if (time == 0.0)\n                    return begin;\n                else if (time == duration)\n                    return begin + change;\n                time = time / (duration / 2.0);\n                if (time < 1.0)\n                    return change / 2.0 * pow(2.0, 10.0 * (time - 1.0)) + begin;\n                return change / 2.0 * (-pow(2.0, -10.0 * (time - 1.0)) + 2.0) + begin;\n            }\n            \n            float Sinusoidal_easeInOut(in float begin, in float change, in float duration, in float time) {\n                return -change / 2.0 * (cos(PI * time / duration) - 1.0) + begin;\n            }\n            \n            float random(in vec3 scale, in float seed) {\n                return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n            }\n            \n            vec3 crossFade(in vec2 uv1, in vec2 uv2, in float dissolve) {\n                return mix(texture2D(previousTexture, uv1).rgb, texture2D(uSampler, uv2).rgb, dissolve);\n            }\n            \n            void main() {\n            \n                vec2 center = vec2(Linear_ease(0.25, 0.5, 1.0, progress), 0.5);\n                float dissolve = Exponential_easeInOut(0.0, 1.0, 1.0, progress);\n            \n                float strength = Sinusoidal_easeInOut(0.0, strength, 0.5, progress);\n                \n                vec3 color = vec3(0.0);\n                float total = 0.0;\n                vec2 toCenter = center - vTextureCoord;\n        \n                float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n            \n                for (float t = 0.0; t <= 40.0; t++) {\n                    float percent = (t + offset) / 40.0;\n                    float weight = 4.0 * (percent - percent * percent);\n                    vec2 p = toCenter * percent * strength;\n                    color += crossFade(vFilterCoord + p, vTextureCoord + p, dissolve) * weight;\n                    total += weight;\n                }\n                gl_FragColor = vec4(color / total, 1.0);\n            }\n        ",e}(_),S=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),A=function(t){function e(){var n=t.call(this,_.vertexSrc,e.fragmentSrc,e.linearblurUniforms)||this;return n.padding=0,n}return S(e,t),e.prototype.apply=function(e,n,o){var r=new vf.Matrix;this.uniforms.filterMatrix=r,this.uniforms.resolution=vf.settings.RESOLUTION,t.prototype.apply.call(this,e,n,o,vf.CLEAR_MODES.NO)},e.prototype.setPreviousTexture=function(t){this.uniforms.previousTexture=t},e.prototype.setProgress=function(t){t=Math.min(1,t),t=Math.max(0,t),this.uniforms.progress=t},Object.defineProperty(e.prototype,"progress",{get:function(){return this.uniforms.progress},set:function(t){t=Math.min(1,t),t=Math.max(0,t),this.uniforms.progress=t},enumerable:!1,configurable:!0}),e.prototype.applyTranisition=function(t){this.target=t,this.target.filters=[this]},e.prototype.dispose=function(){this.target&&(this.target.filters=[])},e.linearblurUniforms={resolution:vf.settings.RESOLUTION,previousTexture:null,progress:0,barWidth:10,amplitude:2,noise:.1,frequency:1},e.fragmentSrc="\n            #ifdef GL_ES\n            precision highp float;\n            #endif\n            \n            uniform sampler2D uSampler;\n            uniform sampler2D previousTexture;\n            uniform float progress;\n            uniform float resolution;\n            \n            uniform int barWidth;\n            uniform float amplitude;\n            uniform float noise;\n            uniform float frequency;\n            \n            varying vec2 vTextureCoord;\n            varying vec2 vFilterCoord;\n            \n            float rand(int num) {\n                return fract(mod(float(num) * 67123.313, 12.0) * sin(float(num) * 10.3) * cos(float(num)));\n            }\n            \n            float wave(int num) {\n                float fn = float(num) * frequency * 0.1  * float(barWidth);\n                return cos(fn * 0.5) * cos(fn * 0.13) * sin((fn+10.0) * 0.3) / 2.0 + 0.5;\n            }\n            \n            float pos(int num) {\n                return noise == 0.0 ? wave(num) : mix(wave(num), rand(num), noise);\n            }\n            \n            void main() {\n                int bar = int(vFilterCoord.x) / barWidth;\n                float scale = 1.0 + pos(bar) * amplitude;\n                float phase = progress * scale;\n                float posY = vFilterCoord.y / resolution;\n                vec2 p;\n                vec4 c;\n                if (phase + posY < 1.0) {\n                    p = vec2(vFilterCoord.x, vFilterCoord.y + mix(0.0, resolution, phase)) / resolution;\n                    c = texture2D(previousTexture, p);\n                } else {\n                    p = vTextureCoord.xy / resolution;\n                    c = texture2D(uSampler, p);\n                }\n                gl_FragColor = c;\n            }\n        ",e}(vf.Filter),w=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),P=function(t){function e(){return t.call(this,_.vertexSrc,e.fragmentSrc,e.linearBlurUniforms)||this}return w(e,t),e.linearBlurUniforms={filterMatrix:vf.Matrix.TEMP_MATRIX,resolution:vf.settings.RESOLUTION,previousTexture:null,progress:0},e.fragmentSrc="\n            #ifdef GL_ES\n            precision highp float;\n            #endif\n            \n            uniform sampler2D uSampler;\n            uniform sampler2D previousTexture;\n            uniform float progress;\n            uniform float resolution;\n            \n            varying vec2 vTextureCoord;\n            varying vec2 vFilterCoord;\n            \n            bool inHeart (vec2 p, vec2 center, float size) {\n                if (size == 0.0) return false;\n                vec2 o = (p-center)/(1.6*size);\n                return pow(o.x*o.x+o.y*o.y-0.3, 3.0) < o.x*o.x*pow(o.y, 3.0);\n            }\n            \n            void main() {\n                vec2 p1 = vFilterCoord.xy / resolution;\n                vec2 p2 = vTextureCoord.xy / resolution;\n                float m = inHeart(p1, vec2(0.5, 0.4), progress) ? 1.0 : 0.0;\n                gl_FragColor = mix(texture2D(previousTexture, p1), texture2D(uSampler, p2), m);\n            }\n        ",e}(_),x=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),k=function(t){function e(){return t.call(this,_.vertexSrc,e.fragmentSrc,e.linearBlurUniforms)||this}return x(e,t),e.linearBlurUniforms={filterMatrix:vf.Matrix.TEMP_MATRIX,resolution:vf.settings.RESOLUTION,previousTexture:null,progress:0,intensity:.1},e.fragmentSrc="\n            #ifdef GL_ES\n            precision highp float;\n            #endif\n            \n            uniform sampler2D uSampler;\n            uniform sampler2D previousTexture;\n            uniform float progress;\n            uniform float resolution;\n            uniform float intensity;\n            \n            varying vec2 vTextureCoord;\n            varying vec2 vFilterCoord;\n            \n            const int PASSES = 8;\n            \n            void main() {\n                vec2 p1 = vFilterCoord.xy;\n                vec2 p2 = vTextureCoord.xy;\n                vec4 c1 = vec4(0.0), c2 = vec4(0.0);\n                float disp = intensity*(0.5-distance(0.5, progress));\n                for (int xi=0; xi<PASSES; ++xi) {\n                        float x = float(xi) / float(PASSES) - 0.5;\n                    for (int yi=0; yi<PASSES; ++yi) {\n                        float y = float(yi) / float(PASSES) - 0.5;\n                        vec2 v = vec2(x,y);\n                        float d = disp;\n                        c1 += texture2D(previousTexture, p1 + d*v);\n                        c2 += texture2D(uSampler, p2 + d*v);\n                    }\n                }\n                c1 /= float(PASSES*PASSES);\n                c2 /= float(PASSES*PASSES);\n                gl_FragColor = mix(c1, c2, progress);\n            }\n        ",e}(_),C=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),I=function(t){function e(){return t.call(this,_.vertexSrc,e.fragmentSrc,e.linearBlurUniforms)||this}return C(e,t),e.linearBlurUniforms={filterMatrix:vf.Matrix.TEMP_MATRIX,resolution:vf.settings.RESOLUTION,previousTexture:null,progress:0},e.fragmentSrc="\n            #ifdef GL_ES\n            precision highp float;\n            #endif\n            \n            uniform sampler2D uSampler;\n            uniform sampler2D previousTexture;\n            uniform float progress;\n            uniform float resolution;\n            \n            varying vec2 vTextureCoord;\n            varying vec2 vFilterCoord;\n            \n            const float MIN_AMOUNT = -0.16;\n            const float MAX_AMOUNT = 1.3;\n            float amount = progress * (MAX_AMOUNT - MIN_AMOUNT) + MIN_AMOUNT;\n            \n            const float PI = 3.141592653589793;\n            \n            const float scale = 512.0;\n            const float sharpness = 3.0;\n            \n            float cylinderCenter = amount;\n            float cylinderAngle = 2.0 * PI * amount;\n            \n            const float cylinderRadius = 1.0 / PI / 2.0;\n            \n            vec3 hitPoint(float hitAngle, float yc, vec3 point, mat3 rrotation)\n            {\n                float hitPoint = hitAngle / (2.0 * PI);\n                point.y = hitPoint;\n                return rrotation * point;\n            }\n            \n            vec4 antiAlias(vec4 color1, vec4 color2, float distanc)\n            {\n                distanc *= scale;\n                if (distanc < 0.0) return color2;\n                if (distanc > 2.0) return color1;\n                float dd = pow(1.0 - distanc / 2.0, sharpness);\n                return ((color2 - color1) * dd) + color1;\n            }\n            \n            float distanceToEdge(vec3 point)\n            {\n                float dx = abs(point.x > 0.5 ? 1.0 - point.x : point.x);\n                float dy = abs(point.y > 0.5 ? 1.0 - point.y : point.y);\n                if (point.x < 0.0) dx = -point.x;\n                if (point.x > 1.0) dx = point.x - 1.0;\n                if (point.y < 0.0) dy = -point.y;\n                if (point.y > 1.0) dy = point.y - 1.0;\n                if ((point.x < 0.0 || point.x > 1.0) && (point.y < 0.0 || point.y > 1.0)) {\n                    return sqrt(dx * dx + dy * dy);\n                }\n                return min(dx, dy);\n            }\n            \n            vec4 seeThrough(float yc, vec2 p, mat3 rotation, mat3 rrotation)\n            {\n                float hitAngle = PI - (acos(yc / cylinderRadius) - cylinderAngle);\n                vec3 point = hitPoint(hitAngle, yc, rotation * vec3(p, 1.0), rrotation);\n                if (yc <= 0.0 && (point.x < 0.0 || point.y < 0.0 || point.x > 1.0 || point.y > 1.0))\n                {\n                    return texture2D(uSampler, vTextureCoord);\n                }\n            \n                if (yc > 0.0) return texture2D(previousTexture, p);\n            \n                vec4 color = texture2D(previousTexture, point.xy);\n                vec4 tcolor = vec4(0.0);\n            \n                return antiAlias(color, tcolor, distanceToEdge(point));\n            }\n            \n            vec4 seeThroughWithShadow(float yc, vec2 p, vec3 point, mat3 rotation, mat3 rrotation)\n            {\n                float shadow = distanceToEdge(point) * 30.0;\n                shadow = (1.0 - shadow) / 3.0;\n            \n                if (shadow < 0.0) shadow = 0.0; else shadow *= amount;\n            \n                vec4 shadowColor = seeThrough(yc, p, rotation, rrotation);\n                shadowColor.r -= shadow;\n                shadowColor.g -= shadow;\n                shadowColor.b -= shadow;\n            \n                return shadowColor;\n            }\n            \n            vec4 backside(float yc, vec3 point)\n            {\n                vec4 color = texture2D(previousTexture, point.xy);\n                float gray = (color.r + color.b + color.g) / 15.0;\n                gray += (8.0 / 10.0) * (pow(1.0 - abs(yc / cylinderRadius), 2.0 / 10.0) / 2.0 + (5.0 / 10.0));\n                color.rgb = vec3(gray);\n                return color;\n            }\n            \n            vec4 behindSurface(float yc, vec3 point, mat3 rrotation)\n            {\n                float shado = (1.0 - ((-cylinderRadius - yc) / amount * 7.0)) / 6.0;\n                shado *= 1.0 - abs(point.x - 0.5);\n            \n                yc = (-cylinderRadius - cylinderRadius - yc);\n            \n                float hitAngle = (acos(yc / cylinderRadius) + cylinderAngle) - PI;\n                point = hitPoint(hitAngle, yc, point, rrotation);\n            \n                if (yc < 0.0 && point.x >= 0.0 && point.y >= 0.0 && \n                    point.x <= 1.0 && point.y <= 1.0 && (hitAngle < PI || amount > 0.5))\n                {\n                    shado = 1.0 - (sqrt(pow(point.x - 0.5, 2.0) + pow(point.y - 0.5, 2.0)) / (71.0 / 100.0));\n                    shado *= pow(-yc / cylinderRadius, 3.0);\n                    shado *= 0.5;\n                }\n                else\n                {\n                    shado = 0.0;\n                }\n                return vec4(texture2D(uSampler, vTextureCoord).rgb - shado, 1.0);\n            }\n            \n            void main()\n            {\n                const float angle = 30.0 * PI / 180.0;\n                float c = cos(-angle);\n                float s = sin(-angle);\n            \n                mat3 rotation = mat3( c, s, 0, -s, c, 0, 0.12, 0.258, 1);\n                c = cos(angle);\n                s = sin(angle);\n            \n                mat3 rrotation = mat3(\tc, s, 0, -s, c, 0, 0.15, -0.5, 1);\n            \n                vec3 point = rotation * vec3(vFilterCoord, 1.0);\n            \n                float yc = point.y - cylinderCenter;\n            \n                if (yc < -cylinderRadius)\n                {\n                    gl_FragColor = behindSurface(yc, point, rrotation);\n                    return;\n                }\n            \n                if (yc > cylinderRadius)\n                {\n                    gl_FragColor = texture2D(previousTexture, vFilterCoord);\n                    return;\n                }\n            \n                float hitAngle = (acos(yc / cylinderRadius) + cylinderAngle) - PI;\n            \n                float hitAngleMod = mod(hitAngle, 2.0 * PI);\n                if ((hitAngleMod > PI && amount < 0.5) || (hitAngleMod > PI/2.0 && amount < 0.0))\n                {\n                    gl_FragColor = seeThrough(yc, vFilterCoord, rotation, rrotation);\n                    return;\n                }\n            \n                point = hitPoint(hitAngle, yc, point, rrotation);\n            \n                if (point.x < 0.0 || point.y < 0.0 || point.x > 1.0 || point.y > 1.0)\n                {\n                    gl_FragColor = seeThroughWithShadow(yc, vFilterCoord, point, rotation, rrotation);\n                    return;\n                }\n            \n                vec4 color = backside(yc, point);\n            \n                vec4 otherColor;\n                if (yc < 0.0)\n                {\n                    float shado = 1.0 - (sqrt(pow(point.x - 0.5, 2.0) + pow(point.y - 0.5, 2.0)) / 0.71);\n                    shado *= pow(-yc / cylinderRadius, 3.0);\n                    shado *= 0.5;\n                    otherColor = vec4(0.0, 0.0, 0.0, shado);\n                }\n                else\n                {\n                    otherColor = texture2D(previousTexture, vFilterCoord);\n                }\n            \n                color = antiAlias(color, otherColor, cylinderRadius - abs(yc));\n            \n                vec4 cl = seeThroughWithShadow(yc, vFilterCoord, point, rotation, rrotation);\n                float dist = distanceToEdge(point);\n            \n                gl_FragColor = antiAlias(color, cl, dist);\n            }\n        ",e}(_),M=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),L=function(t){function e(){var n=t.call(this,"",e.fragmentSrc)||this;return n.padding=0,n}return M(e,t),e.fragmentSrc="\n            precision highp float;\n            varying vec2 vTextureCoord;\n            varying vec2 vFilterCoord;\n            uniform sampler2D uSampler;\n            uniform sampler2D previousTexture;\n            uniform float progress;\n            \n            void main() {\n                vec4 displacement1 = texture2D( previousTexture, vTextureCoord);\n                vec4 displacement2 = texture2D( uSampler, vFilterCoord);\n                vec4 displacement = mix(displacement1, displacement2, vec4(progress));\n                vec2 mixTexture = mix(displacement.xy, vTextureCoord.xy, vec2(progress));\n                vec2 testPos1 = mixTexture + (1.0 - progress) * displacement.xy * 0.5;\n                vec2 testPos = mix(testPos1, vec2(1.0), vec2(1.0 - progress));\n                vec2 distUv = vec2(testPos.x, vTextureCoord.y);\n                vec4 color = texture2D(uSampler, distUv);\n                vec4 color1 = texture2D(previousTexture, distUv);\n                gl_FragColor = vec4(mix(color, vec4(vec3(color1), 0.0), 0.18));\n            }\n        ",e}(_),N=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),j=function(t){function e(){return t.call(this,_.vertexSrc,e.fragmentSrc,e.linearBlurUniforms)||this}return N(e,t),e.linearBlurUniforms={filterMatrix:vf.Matrix.TEMP_MATRIX,resolution:vf.settings.RESOLUTION,previousTexture:null,progress:0,size:.2},e.fragmentSrc="\n            #ifdef GL_ES\n            precision highp float;\n            #endif\n            \n            uniform sampler2D uSampler;\n            uniform sampler2D previousTexture;\n            uniform float progress;\n            uniform float resolution;\n            uniform float size;\n            \n            varying vec2 vTextureCoord;\n            varying vec2 vFilterCoord;\n            \n            float rand (vec2 co) {\n                return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n            }\n            \n            void main() {\n                float r = rand(vec2(0, vTextureCoord.y));\n                float m = smoothstep(0.0, -size, vTextureCoord.x*(1.0-size) + size*r - (progress * (1.0 + size)));\n                gl_FragColor = mix(texture2D(previousTexture, vFilterCoord), texture2D(uSampler, vTextureCoord), m);\n            }\n        ",e}(_),R=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),F=function(t){function e(){return t.call(this,_.vertexSrc,e.fragmentSrc,e.uniforms)||this}return R(e,t),e.uniforms={filterMatrix:vf.Matrix.TEMP_MATRIX,resolution:vf.settings.RESOLUTION,previousTexture:null,progress:0},e.fragmentSrc="\n            #ifdef GL_ES\n            precision highp float;\n            #endif\n            \n            uniform sampler2D uSampler;\n            uniform sampler2D previousTexture;\n            uniform float progress;\n            uniform float resolution;\n            \n            varying vec2 vTextureCoord;\n            varying vec2 vFilterCoord;\n            \n            const float PI = 3.141592653589793;\n            const float MIN_ANGLE = PI / 4.0;\n            const float MAX_ANGLE = PI / 2.0;\n            const float MIN_X = 0.5;\n            const float MAX_X = 0.95;\n            const float sharpness = 3.0;\n            const float scale = 512.0;\n            // float easeProgress = ( pow((progress - 1.0), 3.0) + 1.0 );\n            // float easeProgress = (progress == 1.0) ? 1.0 : -pow(2.0, -10.0 * progress) + 1.0;\n            float p = progress > 0.99 ? 0.99 : progress;\n            float easeProgress =  sqrt(1.0 - pow((p - 1.0), 2.0));\n            float curX = (1.0 - easeProgress) * (MAX_X - MIN_X) + MIN_X;\n            float angle = (easeProgress) * (MAX_ANGLE - MIN_ANGLE) + MIN_ANGLE;\n                     \n            float distanceToLine(vec2 point)\n            {\n                vec2 p0 = vec2(1.0-curX, 1.0);\n                vec2 p1 = vec2(0.0, -(1.0 - curX) * tan(angle) + 1.0);\n                float a = p1.y - p0.y;\n                float b = p0.x - p1.x;\n                float c = p1.x * p0.y - p0.x * p1.y;\n                return abs(a * point.x + b * point.y + c) / sqrt(a * a + b * b);\n            }\n\n            vec4 antiAlias(vec4 color1, vec4 color2, float distanc)\n            {\n                distanc *= scale;\n                if (distanc < 0.0) return color2;\n                if (distanc > 2.0) return color1;\n                float dd = pow(1.0 - distanc / 2.0, sharpness);\n                return ((color2 - color1) * dd) + color1;\n            }\n\n            vec2 getMirro(vec2 point ) \n            {\n                vec2 p0 = vec2(1.0-curX, 1.0);\n                vec2 p1 = vec2(0.0, -(1.0 - curX) * tan(angle) + 1.0);\n                float a = p1.y - p0.y;\n                float b = p0.x - p1.x;\n                float c = p1.x * p0.y - p0.x * p1.y;\n                float k = -2.0 * (a * point.x + b * point.y + c) / (a * a + b * b);\n                vec2 p2 = vec2(point.x + k * a, point.y + k * b);\n                return p2;\n            }\n\n            vec4 curPageBack(vec2 point)\n            {\n                vec2 mirror = getMirro(point);\n                vec4 color = texture2D(uSampler, vec2(1.0 - mirror.x, mirror.y));\n                return color;\n            }\n\n            vec4 curPage(vec2 point)\n            {\n                vec4 color = texture2D(previousTexture, point.xy);\n                return color;\n            }\n            vec4 nextPage(vec2 point)\n            {\n                vec4 color = texture2D(uSampler, point);\n                float d = distanceToLine(point);\n                vec4 shadow = vec4(1.0, 0.0, 0.0, d);\n                if(d < 0.02) {\n                    float c = (0.1 - (0.02 - d)) * (10.0 + progress * 1.5);\n                    return vec4(color.r * c, color.g * c, color.b * c, 1.0);\n                };\n                return color;\n            }\n            bool isNextPage(vec2 point) \n            {\n                vec2 p0 = vec2(1.0-curX, 1.0);\n                vec2 p1 = vec2(0.0, -(1.0 - curX) * tan(angle) + 1.0);\n                vec2 p2 = vec2(point.x - p0.x, point.y - p0.y);\n                vec2 p3 = vec2(point.x - p1.x, point.y - p1.y);\n                return p2.x * p3.y - p3.x * p2.y < 0.0;\n            }\n            bool isCurPageBack(vec2 point)\n            {\n                vec2 p0 = vec2(1.0-curX, 1.0);\n                vec2 p1 = vec2(0.0, -(1.0 - curX) * tan(angle) + 1.0);\n                float a = p1.y - p0.y;\n                float b = p0.x - p1.x;\n                float c = p1.x * p0.y - p0.x * p1.y;\n                float k = -2.0 * (a * point.x + b * point.y + c) / (a * a + b * b);\n                vec2 p2 = vec2(point.x + k * a, point.y + k * b);\n                return p2.x > 0.0 && p2.x < 1.0 && p2.y > 0.0 && p2.y < 1.0;\n            }\n            \n            void main()\n            {\n            \n                vec4 color = vec4(1.0, 0.0, 0.0, 1.0);\n                if (isNextPage(vTextureCoord)) {\n                    color = nextPage(vTextureCoord);\n                } else if (isCurPageBack(vTextureCoord)) {\n                    color = curPageBack(vTextureCoord);\n                } else {\n                    color = curPage(vTextureCoord);\n                }\n                gl_FragColor = color;\n            }\n        ",e}(_),V=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),D=function(t){function e(){return t.call(this,_.vertexSrc,e.fragmentSrc,e.uniforms)||this}return V(e,t),e.uniforms={filterMatrix:vf.Matrix.TEMP_MATRIX,resolution:vf.settings.RESOLUTION,previousTexture:null,progress:0},e.fragmentSrc="\n            #ifdef GL_ES\n            precision highp float;\n            #endif\n            \n            uniform sampler2D uSampler;\n            uniform sampler2D previousTexture;\n            uniform float progress;\n            uniform float resolution;\n            \n            varying vec2 vTextureCoord;\n            varying vec2 vFilterCoord;\n            \n            const float PI = 3.141592653589793;\n            const float MIN_ANGLE = PI / 4.0;\n            const float MAX_ANGLE = PI / 2.0;\n            const float MIN_X = 0.5;\n            const float MAX_X = 0.95;\n            const float sharpness = 3.0;\n            const float scale = 512.0;\n\n            // float easeProgress = ( pow((progress - 1.0), 3.0) + 1.0 );\n            // float easeProgress = (progress == 1.0) ? 1.0 : -pow(2.0, -10.0 * progress) + 1.0;\n            float p = progress > 0.99 ? 0.99 : progress;\n            float easeProgress =  sqrt(1.0 - pow((p - 1.0), 2.0));\n            float curX = (1.0 - easeProgress) * (MAX_X - MIN_X) + MIN_X;\n            float angle = (easeProgress) * (MAX_ANGLE - MIN_ANGLE) + MIN_ANGLE;\n                     \n            float distanceToLine(vec2 point)\n            {\n                vec2 p0 = vec2(curX, 1.0);\n                vec2 p1 = vec2(1.0, -(1.0 - curX) * tan(angle) + 1.0);\n                float a = p1.y - p0.y;\n                float b = p0.x - p1.x;\n                float c = p1.x * p0.y - p0.x * p1.y;\n                return abs(a * point.x + b * point.y + c) / sqrt(a * a + b * b);\n            }\n\n            vec4 antiAlias(vec4 color1, vec4 color2, float distanc)\n            {\n                distanc *= scale;\n                if (distanc < 0.0) return color2;\n                if (distanc > 2.0) return color1;\n                float dd = pow(1.0 - distanc / 2.0, sharpness);\n                return ((color2 - color1) * dd) + color1;\n            }\n\n            vec2 getMirro(vec2 point ) \n            {\n                vec2 p0 = vec2(curX, 1.0);\n                vec2 p1 = vec2(1.0, -(1.0 - curX) * tan(angle) + 1.0);\n                float a = p1.y - p0.y;\n                float b = p0.x - p1.x;\n                float c = p1.x * p0.y - p0.x * p1.y;\n                float k = -2.0 * (a * point.x + b * point.y + c) / (a * a + b * b);\n                vec2 p2 = vec2(point.x + k * a, point.y + k * b);\n                return p2;\n            }\n\n            vec4 curPageBack(vec2 point)\n            {\n                vec2 mirror = getMirro(point);\n                vec4 color = texture2D(uSampler, vec2(1.0 - mirror.x, mirror.y));\n                return color;\n            }\n\n            vec4 curPage(vec2 point)\n            {\n                vec4 color = texture2D(previousTexture, point);\n                float d = distanceToLine(point);\n                vec4 shadow = vec4(1.0, 0.0, 0.0, 1.0);\n                // return shadow;\n                // if(d < 0.2) {\n                //     float c = (0.1 - (0.02 - d)) * (10.0 + progress * 1.5);\n                //     return vec4(color.r * c, color.g * c, color.b * c, 1.0);\n                // };\n                return color;\n            }\n            vec4 nextPage(vec2 point)\n            {\n                vec4 color = texture2D(uSampler, point);\n                float d = distanceToLine(point);\n                vec4 shadow = vec4(1.0, 0.0, 0.0, d);\n                if(d < 0.02) {\n                    float c = (0.1 - (0.02 - d)) * (10.0 + progress * 1.5);\n                    return vec4(color.r * c, color.g * c, color.b * c, 1.0);\n                };\n                return color;\n            }\n            bool isNextPage(vec2 point) \n            {\n                vec2 p0 = vec2(curX, 1.0);\n                vec2 p1 = vec2(1.0, -(1.0 - curX) * tan(angle) + 1.0);\n                vec2 p2 = vec2(point.x - p0.x, point.y - p0.y);\n                vec2 p3 = vec2(point.x - p1.x, point.y - p1.y);\n                return p2.x * p3.y - p3.x * p2.y > 0.0;\n            }\n            bool isCurPageBack(vec2 point)\n            {\n                vec2 p0 = vec2(curX, 1.0);\n                vec2 p1 = vec2(1.0, -(1.0 - curX) * tan(angle) + 1.0);\n                float a = p1.y - p0.y;\n                float b = p0.x - p1.x;\n                float c = p1.x * p0.y - p0.x * p1.y;\n                float k = -2.0 * (a * point.x + b * point.y + c) / (a * a + b * b);\n                vec2 p2 = vec2(point.x + k * a, point.y + k * b);\n                return p2.x > 0.0 && p2.x < 1.0 && p2.y > 0.0 && p2.y < 1.0;\n            }\n            \n            \n            void main()\n            {\n            \n                vec4 color = vec4(1.0, 0.0, 0.0, 1.0);\n                if (isNextPage(vTextureCoord)) {\n                    color = nextPage(vTextureCoord);\n                } else if (isCurPageBack(vTextureCoord)) {\n                    color = curPageBack(vTextureCoord);\n                } else {\n                    color = curPage(vTextureCoord);\n                }\n                gl_FragColor = color;\n            }\n        ",e}(_),B=function(){function t(){this._progress=0}return Object.defineProperty(t.prototype,"progress",{get:function(){return this._progress},set:function(t){this._progress=t,this.prevSprite&&(this.prevSprite.alpha=1-this._progress)},enumerable:!1,configurable:!0}),t.prototype.setPreviousTexture=function(t){this.prevTexture=t,this.prevTexture&&(this.prevSprite=vf.Sprite.from(this.prevTexture))},t.prototype.applyTranisition=function(t){this.target=t,this.target&&this.target.parent&&this.prevSprite&&(this.prevSprite.x=this.target.x,this.prevSprite.y=this.target.y,this.target.parent.addChild(this.prevSprite))},t.prototype.dispose=function(){var t;this.prevSprite&&this.prevSprite.parent&&(this.prevSprite.parent.removeChild(this.prevSprite),null===(t=this.prevTexture)||void 0===t||t.destroy(),this.prevTexture=void 0,this.prevSprite=void 0)},t}(),U=function(){function t(t,e,n){this.vfStage=t,this.prevTexture=e,this.data=n}return t.prototype.run=function(){var t=this.getTransition(this.data.type);if(t){var e=this.vfStage.systemEvent;t.setPreviousTexture(this.prevTexture),t.progress=0,t.applyTranisition(this.vfStage.container);var n=vf.gui.Tween.to(t,{progress:1},this.data.duration);n.once(vf.gui.Tween.Event.complete,(function(){t.dispose(),e.emit("status",{code:"TransitionEnd",level:"status",data:null})})),n.start(),e.emit("status",{code:"TransitionStart",level:"status",data:null})}},t.prototype.getTransition=function(t){var e;if("none"===t)return null;if(this.vfStage&&(1!==this.vfStage.scaleX||1!==this.vfStage.scaleY||!(null===(e=this.vfStage.app)||void 0===e?void 0:e.renderer.context).webGLVersion))return new B;switch(t){case"fadeOut":return new B;case"circleWipe":return new T;case"crossZoom":return new O;case"doomScreen":return new A;case"heartWipe":return new P;case"linearBlur":return new k;case"pageCurl":return new I;case"toTear":return new L;case"wind":return new j;case"pageFlipLeft":return new F;case"pageFlipRight":return new D;default:return null}return null},t}();function G(t,e){for(var n=t;e.length>0;){var o=e.shift();if(!(n&&n instanceof y&&o))return;n=n.getChildById(o)}return n}function X(t,e){if(!e)return t;if(e.length<=0)return t;var n=e.concat();return"-1"===n[0]?function(t,e){if(e.shift(),t.vfStage){var n,o=t.vfStage.getCurScene(),r=e.shift();if(o){for(var i=0,a=o.uiChildren.length;i<a&&!((n=o.uiChildren[i])instanceof y&&n.id===r);i++);if(void 0!==n)return G(n,e)}}}(t,n):G(t,n)}function Y(t,e){if(t&&Array.isArray(e)&&e.length>1&&(e[0]===o.VARIABLE||e[0]===o.PROPERTY||e[0]===o.ARRAY_VALUE||e[0]===o.PARAM_VALUE||e[0]===o.OBJECT_VALUE||e[0]===o.COMPONENT)){var n=t.vfStage;if(n&&n.variableManager){var r=n.variableManager.getExpressItemValue(t,e);if(r&&r instanceof vf.gui.DisplayObject)return r}}return X(t,e)}function H(t){return"number"==typeof t&&!isNaN(t)}function z(t){if("object"==typeof t)try{return JSON.parse(JSON.stringify(t))}catch(e){return t}return t}var K=function(){function t(){this.variableConfig={},this.variableMap={},this.runFunctionId=0,this.functionMap={}}return t.prototype.shuffle=function(t){for(var e=t.length-1;e>=0;e--){var n=Math.floor(Math.random()*(e+1)),o=t[n];t[n]=t[e],t[e]=o}},t.prototype.clear=function(){this.variableMap={},this.functionMap={}},t.prototype.getFunctionId=function(){return++this.runFunctionId},t.prototype.getFunctionTask=function(t){return this.functionMap[t]},t.prototype.setFunctionTask=function(t,e){this.functionMap[t]=e},t.prototype.addVariableConfig=function(t,e){if(!this.variableConfig[t]){var n=this.normalizeVariableConfig(e);this.variableConfig[t]=n}},t.prototype.normalizeVariableConfig=function(t){for(var e in t)if(t.hasOwnProperty(e)){var n=t[e],o=this.createIVariableData(e,n);t[e]=o}return t},t.prototype.addVariableToGlobal=function(e){var n=t.GLOBAL_ID;if(this.variableMap[n]=this.deepCopy(e),this.variableConfig[n]){var o=this.variableConfig[n];this.variableMap[n]=this.deepCopy(o)}else if(this.addVariableConfig(n,e),this.variableConfig[n]){o=this.variableConfig[n];this.variableMap[n]=this.deepCopy(o)}},t.prototype.addVariableToComponent=function(t){var e=t.libId;if(e&&this.variableConfig[e.toString()]){var n=this.variableConfig[e.toString()];this.variableMap[t.id.toString()]=this.deepCopy(n)}},t.prototype.addVariableDataToComponent=function(t,e,n,o){var r=t.libId,i=t.id;this.addVariable(r,i,e,n,o)},t.prototype.addVariableDataToGlobal=function(e,n,o){this.addVariable(t.GLOBAL_ID,t.GLOBAL_ID,e,n,o)},t.prototype.addVariable=function(t,e,n,o,r){var i={id:n,type:o,value:r},a={id:n,type:o,value:r},s=this.variableConfig[t];s||(s={},this.variableConfig[t]=s),s[n]=i;var c=this.variableMap[e];c||(c={},this.variableMap[e]=c),c[n]=a},t.prototype.getGlobalVariable=function(e){return this.getVariable(t.GLOBAL_ID,e)},t.prototype.getVariable=function(t,e){var n=this.variableMap[t];if(n&&n[e])return n[e]},t.prototype.getVariableByData=function(e,n){if(n[0]===o.PARAM_VALUE)return this.getVariable(t.GLOBAL_ID,n[2]);var r=Y(e,n[1]),i=r?r.id.toString():t.GLOBAL_ID;return this.getVariable(i,n[2])},t.prototype.caculateExpress=function(e,n){for(var r=[],i=[],a=0,s=n.length;a<s;a++){var c=n[a];switch(c[0]){case o.CONST:case o.VARIABLE:case o.STSTEN:case o.RANDOM:case o.PROPERTY:case o.ARRAY_LEN:case o.ARRAY_VALUE:case o.OBJECT_VALUE:case o.PARAM_VALUE:case o.ARRAY_FUNCTION:case o.STRING_FUNCTION:case o.PARSE_FLOAT:case o.PARSE_INT:case o.COMPONENT:r.push(c);break;case o.OPERATION:switch(c[1]){case"(":i.push(c);break;case")":for(var p=i.pop();p&&"("!==p[1];)r.push(p),p=i.pop();break;default:var u=c[1],l=t.OPERATE_PRIORITY[u];if(!l)return this.emitError(e,"E1001",[u],"warning"),0;if(i.length>0){var h=i[i.length-1],f=t.OPERATE_PRIORITY[h[1]];if(l>f)i.push(c);else{for(;l<=f&&(r.push(h),i.pop(),i.length>0);)h=i[i.length-1],f=t.OPERATE_PRIORITY[h[1]];i.push(c)}}else i.push(c)}}}if(i.length>0)for(;i.length>0;){(u=i.pop())&&r.push(u)}return this.caculateExpressValue(e,r)},t.prototype.getExpressItemValue=function(t,e){var n;switch(e[0]){case o.CONST:n=z(n=e[1]);break;case o.VARIABLE:var i=this.getVariableByData(t,e);i?n=i.value:this.emitError(t,"E1002",[e.join(",")],"warning");break;case o.STSTEN:var a=new Date,s=0;switch(e[1]){case r.TIME:s=vf.gui.TickerShared.currentTickerTime;break;case r.YEAR:s=a.getFullYear();break;case r.MONTH:s=a.getMonth();break;case r.DAY:s=a.getDay();break;case r.DATE:s=a.getDate();break;case r.HOUR:s=a.getHours();break;case r.MINUTE:s=a.getMinutes();break;case r.SECOND:s=a.getSeconds();break;case r.MILLISECOND:s=a.getMilliseconds()}n=s;break;case o.RANDOM:var c=0;if(e.length>=3){var p=e[1],u=e[2];c=Math.round(Math.random()*(u-p))+p}else c=Math.random();n=c;break;case o.COMPONENT:n=Y(t,e[1]);break;case o.PROPERTY:var l=Y(t,e[1]);if(l&&e.length>=3){for(var h=2,f=e.length;h<f;h++){var m=e[h];l&&void 0!==m&&(l=l[m])}n=l}else n=void 0;break;case o.ARRAY_LEN:var d=this.getVariableByData(t,e);d?n=d.value.length:this.emitError(t,"E1002",[e.join(",")],"warning");break;case o.ARRAY_VALUE:var v=this.getVariableByData(t,e);if(v){var y=v.value,g=e[3];if(Array.isArray(g)){var _=this.getExpressItemValue(t,g);H(_)?g=_:(this.emitError(t,"E1003",[g],"warning"),g=0)}n=y[g],e.length>=5&&n&&(n=n[e[4]])}else this.emitError(t,"E1002",[e.join(",")],"warning");break;case o.ARRAY_FUNCTION:var b=this.getVariableByData(t,e);if(b)if(Array.isArray(b.value)){var T=b.value;switch(e[3]){case"pop":n=T.pop();break;case"push":if(e.length>4){var E=this.getExpressItemValue(t,e[4]);n=T.push(E)}break;case"shift":n=T.shift();break;case"unshift":if(e.length>4){var O=this.getExpressItemValue(t,e[4]);n=T.unshift(O)}break;case"concat":if(e.length>3)if(e.length>4){var S=this.getExpressItemValue(t,e[4]);n=T.concat(S)}else n=T.concat();break;case"splice":if(5===e.length){var A=this.getExpressItemValue(t,e[4]);n=T.splice(A)}else if(6===e.length){A=this.getExpressItemValue(t,e[4]);var w=this.getExpressItemValue(t,e[5]);n=T.splice(A,w)}else if(e.length>6){A=this.getExpressItemValue(t,e[4]),w=this.getExpressItemValue(t,e[5]);var P=this.getExpressItemValue(t,e[6]);n=T.splice(A,w,P)}break;default:this.emitError(t,"E1004",[e[3]],"warning")}}else this.emitError(t,"E1005",[e.join(",")],"warning");else this.emitError(t,"E1002",[e.join(",")],"warning");break;case o.OBJECT_VALUE:case o.PARAM_VALUE:var x=this.getVariableByData(t,e);if(x){var k=x.value;for(h=3,f=e.length;h<f;h++){m=e[h];k&&void 0!==m&&(k=k[m])}n=k}break;case o.STRING_FUNCTION:var C=this.getVariableByData(t,e);if(C)if("string"==typeof C.value){var I=C.value;switch(e[3]){case"indexOf":if(e.length>=5){var M=this.getExpressItemValue(t,e[4]);n=I.indexOf(M)}else n=-1;break;case"replace":if(e.length>=6){var L=this.getExpressItemValue(t,e[4]),N=this.getExpressItemValue(t,e[5]);n=I.replace(L,N)}break;case"split":if(e.length>=5){var j=this.getExpressItemValue(t,e[4]);if(5===e.length)n=I.split(j);else{var R=this.getExpressItemValue(t,e[5]);n=I.split(j,R)}}break;case"substr":if(e.length>=5){var F=this.getExpressItemValue(t,e[4]);if(5===e.length)n=I.substr(F);else{var V=this.getExpressItemValue(t,e[5]);n=I.substr(F,V)}}break;case"substring":if(e.length>=5){F=this.getExpressItemValue(t,e[4]);if(5===e.length)n=I.substring(F);else{var D=this.getExpressItemValue(t,e[5]);n=I.substring(F,D)}}break;default:this.emitError(t,"E1014",[e[3]],"warning")}}else this.emitError(t,"E1015",[e.join(",")],"warning");else this.emitError(t,"E1002",[e.join(",")],"warning");break;case o.PARSE_INT:if(e.length>=2){var B=this.getExpressItemValue(t,e[1]);if(2===e.length)n=parseInt(B);else{var U=this.getExpressItemValue(t,e[2]);n=parseInt(B,U)}}break;case o.PARSE_FLOAT:if(e.length>=2){B=this.getExpressItemValue(t,e[1]);n=parseFloat(B)}}return n},t.prototype.caculateExpressValue=function(t,e){var n=[];if(1===e.length)return this.getExpressItemValue(t,e[0]);for(var r=0,i=e.length;r<i;r++){var a=e[r];switch(a[0]){case o.OPERATION:var s=void 0,c=void 0;"!"===a[1]||(c=n.pop()),s=n.pop();var p=this.caculateOneExpress(t,a[1],s,c);n.push(p);break;default:n.push(a)}}return 1===n.length?n[0][1]:(this.emitError(t,"E1006",void 0,"warning"),0)},t.prototype.caculateOneExpress=function(t,e,n,r){var i,a,s,c=[o.CONST,0];switch(n&&(i=this.getExpressItemValue(t,n)),r&&(a=this.getExpressItemValue(t,r)),e){case"*":s=i*a;break;case"/":s=i/a;break;case"%":s=i%a;break;case"+":s=i+a;break;case"-":s=i-a;break;case">=":s=i>=a;break;case"<=":s=i<=a;break;case">":s=i>a;break;case"<":s=i<a;break;case"==":s=i==a;break;case"===":s=i===a;break;case"!=":s=i!=a;case"!==":s=i!==a;break;case"!":s=!i;break;case"&&":s=i&&a;break;case"||":s=i||a;break;case"=":if(s=a,n)switch(n[0]){case o.VARIABLE:var p=this.getVariableByData(t,n);p?p.value=s:this.emitError(t,"E1002",[n.join(",")],"warning");break;case o.PROPERTY:var u=n[1],l=n[2],h=Y(t,u);if(h&&n.length>=3){for(var f=h,m=l,d=2,v=n.length;d<v&&(m=n[d],d!==v-1);d++)f?f=f[m]:this.emitError(t,"E1007",[n.join(",")],"warning");f&&m?f[m]=s:this.emitError(t,"E1007",[n.join(",")],"warning")}break;case o.ARRAY_LEN:var y=this.getVariableByData(t,n);y?y.value.length=s:this.emitError(t,"E1002",[n.join(",")],"warning");break;case o.ARRAY_VALUE:var g=this.getVariableByData(t,n);if(g){var _=g.value,b=n[3]||0;if(Array.isArray(b)){var T=this.getExpressItemValue(t,b);H(T)?b=T:(this.emitError(t,"E1003",[b],"warning"),b=0)}if(n.length>=5){var E=_[b],O=void 0;for(d=4,v=n.length;d<v;d++)O=n[d],d<v-1&&E[O]&&(E=E[O]);E&&void 0!==O&&(E[O]=s)}else _[b]=s}else this.emitError(t,"E1002",[n.join(",")],"warning");break;case o.OBJECT_VALUE:case o.PARAM_VALUE:var S=this.getVariableByData(t,n);if(S){for(E=S.value,O=void 0,d=3,v=n.length;d<v;d++)O=n[d],d<v-1&&E[O]&&(E=E[O]);E&&void 0!==O?E[O]=s:S.value=s}break;case o.CONST:this.emitError(t,"E1008",[n.join(",")],"warning")}break;default:this.emitError(t,"E1001",[e],"warning")}return c[1]=s,c},t.prototype.deepCopy=function(t){var e=JSON.stringify(t);return JSON.parse(e)},t.prototype.isIVariableData=function(t){return e=t,!("[object Object]"!==Object.prototype.toString.call(e)||!t.hasOwnProperty("type")||!t.hasOwnProperty("value")||"array"!==t.type&&"boolean"!==t.type&&"number"!==t.type&&"object"!==t.type&&"string"!==t.type);var e},t.prototype.createIVariableData=function(t,e){if(this.isIVariableData(e))return e;var n={id:t,type:"object",value:e};return"boolean"==typeof e?n.type="boolean":!function(t){return"string"==typeof t}(e)?H(e)?n.type="string":!function(t){return Array.isArray(t)}(e)?n.type="object":n.type="array":n.type="string",n},t.prototype.emitError=function(t,e,n,o){if(void 0===o&&(o="error"),!t||!t.vfStage)throw new Error(e+": "+(null==n?void 0:n.join(" ")));t.vfStage.systemEvent.emitError(e,n,o)},t.GLOBAL_ID="global",t.OPERATE_PRIORITY={"*":100,"/":100,"%":98,"+":97,"-":97,">=":95,"<=":94,">":93,"<":92,"==":91,"===":91,"!=":90,"!==":90,"!":89,"&&":88,"||":87,"=":86},t}(),$=function(){function t(t){this.trackIdMap=[],this.assetIdMap=new Map,this.audioMap=new Map,this.stage=t}return t.prototype.getAudio=function(t){if(void 0!==t)return this.audioMap.get(t)},t.prototype.clear=function(){this.pause();for(var t,e=this.trackIdMap;e.length>0;)(t=this.getAudio(e.shift()))&&t.dispose();this.assetIdMap.clear(),this.audioMap.clear()},t.prototype.pause=function(){var t,e=this;this.trackIdMap.forEach((function(n){(t=e.getAudio(n))&&t.pause()}))},t.prototype.resume=function(){var t,e=this;this.trackIdMap.forEach((function(n){(t=e.getAudio(n))&&t.play()}))},t.prototype.pauseSound=function(t){void 0===t&&(t={});var e=this.stage.res.data.assets[t.assetId.toString()];if(void 0!==e&&void 0!==e.url&&""!==e.url){var n=this.getAudio(t.trackId);n&&n.pause()}else console.warn("playback failed,missing assetId!",t)},t.prototype.stopSound=function(t){void 0===t&&(t={});var e=this.stage.res.data.assets[t.assetId.toString()];if(void 0!==e&&void 0!==e.url&&""!==e.url){var n=this.getAudio(t.trackId);n&&n.stop()}else console.warn("playback failed,missing assetId!",t)},t.prototype.resumeSound=function(t){var e=this.stage.res.data.assets[t.assetId.toString()];if(void 0!==e&&void 0!==e.url&&""!==e.url){var n=this.getAudio(t.trackId);n&&n.paused&&n.play()}else console.warn("playback failed,missing assetId!",t)},t.prototype.playSound=function(t){var e=this.stage.res.data.assets[t.assetId.toString()];if(void 0!==e&&void 0!==e.url&&""!==e.url){var n=this.getAudio(t.trackId);if(n){if(this.assetIdMap.get(t.trackId)===e.url)return void n.play(0,0);n.dispose()}n=new vf.gui.Audio,this.stage.addChild(n),n.audioUid=this.stage.config.uuid.toString()+t.trackId,n.autoplay=!1,n.src=t.assetId,n.play(t.time,t.offset,t.length),this.audioMap.set(t.trackId,n),this.trackIdMap.push(t.trackId),this.assetIdMap.set(t.trackId,e.url)}else console.warn("playback failed,missing assetId!",t)},t.prototype.isWeixin=function(){var t=window.navigator.userAgent.toLowerCase();return/micromessenger/.test(t)},t}(),W=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),J=function(t){function e(e){var n=t.call(this)||this;return n.id="-1",n.component=null,n.vfStage=e,n}return W(e,t),e.prototype.pause=function(){this.component&&this.component.pause()},e.prototype.resume=function(){this.component&&this.component.resume()},e.prototype.addComponent=function(t){this.component=t,this.component.vfStage=this.vfStage,this.component.runAction(),this.component.emitAddToChildBefore(),this.addChild(t),this.component.emitAddToChild(),this.component.playDefaultAnimation()},e.prototype.removeComponent=function(){this.component&&(this.component.emitRemoveToChildBefore(),this.removeChild(this.component),this.component.emitRemoveToChild(),this.component.stop(),this.component.vfStage=void 0)},e.prototype.dispose=function(){this.component&&(this.removeComponent(),this.component.dispose()),this.component=null},e}(vf.gui.Container),q=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Z=function(t){function e(e,n){var o,r=t.call(this)||this;return r.attachList=[],r.attachMap=((o={})[vf.gui.Interaction.TouchMouseEvent.onUp]=vf.gui.Interaction.TouchMouseEvent.onDown,o[vf.gui.Interaction.TouchMouseEvent.onMouseLeave]=vf.gui.Interaction.TouchMouseEvent.onMouseEnter,o[vf.gui.Interaction.TouchMouseEvent.onMouseEnter]=vf.gui.Interaction.TouchMouseEvent.onMouseLeave,o),r.component=e,r._loopComplete=!1,r.data=n,r.eventName=n.event,r.system=!0===n.system,r.global=!0===n.global,r}return q(e,t),e.prototype.run=function(){if(t.prototype.run.call(this),this._loopComplete=!0,this.component)if(this.loopTask&&(this.loopTask.off(s.EVENT_COMPLETE,this.onLoopComplete,this),this.loopTask.on(s.EVENT_COMPLETE,this.onLoopComplete,this)),this.system)(e=this.component.vfStage)&&(e.systemEvent.off(this.eventName,this.onTriger,this),e.systemEvent.on(this.eventName,this.onTriger,this));else if(this.global){var e;(e=this.component.vfStage)&&(e.off(this.eventName,this.onTriger,this),e.on(this.eventName,this.onTriger,this))}else this.target=Y(this.component,this.data.target);this.complete()},Object.defineProperty(e.prototype,"target",{get:function(){return this._component},set:function(t){this._component&&(this._component.off(this.eventName,this.onTriger,this),this.detachEvents(this._component,this.eventName)),this._component=t,this._component&&(this._component.on(this.eventName,this.onTriger,this),this.attachEvents(this._component,this.eventName))},enumerable:!1,configurable:!0}),e.prototype.attachEvents=function(t,e){if(void 0!==this.attachMap[e]&&0===t.listenerCount(this.attachMap[e])){var n=this.attachMap[e],o=function(){};t.on(n,o,this),this.attachList.push({target:t,event:e,appendEvent:n,handler:o})}},e.prototype.detachEvents=function(t,e){if(this.attachMap[e])for(var n=this.attachList.length-1;n>=0;n--){var o=this.attachList[n];o.target===t&&o.event===e&&t.off(o.appendEvent,o.handler),this.attachList.splice(n,1)}},e.prototype.stop=function(){if(this.complete(),this.component)if(this.system)(e=this.component.vfStage)&&e.systemEvent.off(this.eventName,this.onTriger,this);else if(this.global){var e;(e=this.component.vfStage)&&e.off(this.eventName,this.onTriger,this)}else this.target=void 0;this.loopTask&&(this.loopTask.off(s.EVENT_COMPLETE,this.onLoopComplete,this),this.loopTask.complete()),t.prototype.stop.call(this)},e.prototype.break=function(){this.complete(),t.prototype.break.call(this)},e.prototype.onLoopComplete=function(){this._loopComplete=!0},e.prototype.onSystemTriger=function(t){t.code===this.eventName&&this.onTriger()},e.prototype.onTriger=function(){this._isPaused||this.loopTask&&this._loopComplete&&(this._loopComplete=!1,this.loopTask.run())},e}(f),Q=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),tt=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.data=n,o}return Q(e,t),e.prototype.run=function(){t.prototype.run.call(this);var e=Y(this.component,this.data.target);e&&(e[this.data.property]=this.getValue()),this.complete()},e.prototype.getValue=function(){if(Array.isArray(this.data.value)&&this.component.vfStage)return this.component.vfStage.variableManager.getExpressItemValue(this.component,this.data.value);return this.data.value},e}(p),et=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),nt=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.data=n,o}return et(e,t),e.prototype.run=function(){(t.prototype.run.call(this),this.component&&this.component.vfStage)&&this.component.vfStage.variableManager.caculateExpress(this.component,this.data.express);this.complete()},e}(p),ot=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),rt=function(t){function e(e){var n=t.call(this)||this;return n.conditions=[],n.conditionsRun=[],n.component=e,n}return ot(e,t),e.prototype.addCondition=function(t,e){t&&t.length?(this.conditions.push(t),this.conditionsRun.push(e)):this.addElse(e)},e.prototype.addElse=function(t){this.elseRun=t},e.prototype.run=function(){t.prototype.run.call(this),this.curRun=this.findTask(),this.curRun?(this.curRun.on(s.EVENT_COMPLETE,this.onTaskComplete,this),this.curRun.on(s.EVENT_BREAK,this.onTaskBreak,this),this.curRun.run()):this.complete()},e.prototype.findTask=function(){if(this.component.vfStage){for(var t=this.component.vfStage.variableManager,e=0,n=this.conditions.length;e<n;e++){var o=this.conditions[e];if(t.caculateExpress(this.component,o))return this.conditionsRun[e]}if(this.elseRun)return this.elseRun}},e.prototype.onTaskComplete=function(t){this.curRun&&this.curRun.off(s.EVENT_COMPLETE,this.onTaskComplete,this),this.complete()},e.prototype.onTaskBreak=function(t){this.break(),this.complete()},e}(p),it=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),at=function(t){function e(e,n,o,r){var i=t.call(this)||this;return i.funId="",i.component=e,i.funName=n,i.fun=r,i.fun.formalParams=o.formalParams,i.data=o,i}return it(e,t),e.prototype.run=function(){if(t.prototype.run.call(this),this.component.vfStage){var e=this.component.vfStage.variableManager,n=this.funName,o=Y(this.component,this.data.target);o&&(n=o.hashCode+this.funName),e.setFunctionTask(n,this.fun),this.complete()}else this.complete()},e.prototype.stop=function(){t.prototype.stop.call(this),this.fun&&this.fun.stop()},e}(p),st=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ct=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.data=n,o}return st(e,t),e.prototype.run=function(){t.prototype.run.call(this),this._component=Y(this.component,this.data.target);var e=this.getValue(),n=this.getTimes(),o=this.getTrackId()||0;this._component&&this._component.vfStage&&(Array.isArray(e)?this._component.playMulit(e,n,o):this._component.play(e,n,o)),this.complete()},e.prototype.getValue=function(){if(Array.isArray(this.data.name)&&(this._component&&this.component.vfStage))return this.component.vfStage.variableManager.getExpressItemValue(this._component,this.data.name);return this.data.name},e.prototype.getTimes=function(){if(Array.isArray(this.data.times)&&(this._component&&this.component.vfStage))return this.component.vfStage.variableManager.getExpressItemValue(this._component,this.data.times);return this.data.times},e.prototype.getTrackId=function(){if(Array.isArray(this.data.trackId)&&(this._component&&this.component.vfStage))return this.component.vfStage.variableManager.getExpressItemValue(this._component,this.data.trackId);return this.data.trackId},e}(p),pt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ut=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.dataType=n.type,o.data=n,o}return pt(e,t),e.prototype.run=function(){if(t.prototype.run.call(this),this.component.vfStage){var e=this.component.vfStage.soundManager,n=this.component.vfStage.variableManager;if(46===this.dataType)return e.clear(),void this.complete();var o=void 0;try{o=n.getExpressItemValue(this.component,this.data.value)}catch(t){vf.utils.deprecation("5.2.1-v14","Please use the new sound API")}if(void 0===o)return void console.log("Please use the new sound API");if(void 0===o.assetId)return void console.log("execute sound failed, missing assetId");if(void 0===o.trackId)return void console.log("execute sound failed, missing trackId");o.mode=o.mode||"sound";var r=void 0;if(Array.isArray(o.assetId)){var i=n.getExpressItemValue(this.component,o.assetId);r=i&&void 0!==i.value?i.value:i}else r=o.assetId;switch(o.assetId=r,this.dataType){case 16:e.playSound(o);break;case 33:e.pauseSound(o);break;case 34:e.resumeSound(o);break;case 47:e.stopSound(o)}this.complete()}else this.complete()},e}(p),lt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ht=function(t){function e(e,n,o){var r=t.call(this)||this;return r.runId=-1,r.paramIds=[],r.component=e,r.funName=n,r.data=o,r}return lt(e,t),e.prototype.run=function(){if(t.prototype.run.call(this),this._component=Y(this.component,this.data.target),this._component instanceof y&&this._component&&this._component.vfStage){var e=this._component.vfStage.variableManager,n=this.funName;if(this.runId=e.getFunctionId(),n=this._component.hashCode+this.funName,this.fun=e.getFunctionTask(n),this.fun){if(this.paramIds.length=0,this.fun.formalParams){var r=this.fun.formalParams?this.fun.formalParams.length:0,i=this.data.params?this.data.params.length:0;if(r!=i)if(i>r)this.data.params&&(this.data.params.length=r);else{this.data.params||(this.data.params=[]);for(var a=i;a<r;a++)this.data.params.push([o.CONST,void 0])}}if(this.data.params){for(var c=[],p=(a=0,this.data.params.length);a<p;a++){var u=d=this.data.params[a];if(Array.isArray(d))u=e.getExpressItemValue(this.component,d);c.push(u)}for(a=0,p=c.length;a<p;a++){var l=n+this.runId+"param_"+a;this.paramIds.push(l),e.variableMap[K.GLOBAL_ID]||(e.variableMap[K.GLOBAL_ID]={}),e.variableMap[K.GLOBAL_ID][l]={id:l,type:"object",value:c[a]}}}this.paramIds.length&&this.fun.injectParams(this.paramIds),this.fun.on(s.FUNCTION_RUN_COMPLETE,this.onRunComplete,this),this.fun.runWithId(this.runId)}else this.complete()}else{if(this.component.vfStage){e=this.component.vfStage.variableManager;var h=this._component,f=this.data.name;Array.isArray(f)&&(f=e.getExpressItemValue(this.component,f));var m=[];if(this.data.params)for(a=0,p=this.data.params.length;a<p;a++){var d=e.getExpressItemValue(this.component,this.data.params[a]);m.push(d)}h&&f&&h[f]&&h[f].apply(h,m)}this.complete()}},e.prototype.stop=function(){t.prototype.stop.call(this),this.fun&&this.fun.stopWithId(this.runId),this.complete()},e.prototype.break=function(){t.prototype.break.call(this),this.fun&&this.fun.breakWithId(this.runId),this.complete()},e.prototype.complete=function(){if(this.runId=0,this.fun&&this.fun.off(s.FUNCTION_RUN_COMPLETE,this.onRunComplete,this),this.paramIds.length&&this.component&&this.component.vfStage)for(var e=this.component.vfStage.variableManager,n=0,o=this.paramIds.length;n<o;n++){var r=this.paramIds[n];delete e.variableMap[K.GLOBAL_ID][r]}t.prototype.complete.call(this)},e.prototype.onRunComplete=function(t){t===this.runId&&this.complete()},e}(p);var ft=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),mt=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.data=n,o}return ft(e,t),e.prototype.run=function(){var t;(null===(t=this.component.vfStage)||void 0===t?void 0:t.config.debug)&&function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="[VF LOG]";switch(t.length){case 1:return console.log(n,t[0]);case 2:return console.log(n,t[0],t[1]);case 3:return console.log(n,t[0],t[1],t[2]);case 4:return console.log(n,t[0],t[1],t[2],t[3]);case 5:return console.log(n,t[0],t[1],t[2],t[3],t[4]);case 6:console.log(n,t[0],t[1],t[2],t[3],t[4],t[5])}}(this.getValue()),this.complete()},e.prototype.getValue=function(){if(Array.isArray(this.data.value)&&this.component.vfStage)return this.component.vfStage.variableManager.getExpressItemValue(this.component,this.data.value);return this.data.value},e}(p),dt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),vt=function(t){function e(e,n){var o=t.call(this)||this;return o._totalTimes=0,o._curTimes=0,o._paramId="",o._paramIds=[],o.component=e,o.data=n,o}return dt(e,t),e.prototype.run=function(){t.prototype.run.call(this),this._totalTimes=this.getforin(),this._curTimes=-1,this.loopTask&&(this.loopTask.on(s.EVENT_COMPLETE,this.onLoopComplete,this),this.loopTask.on(s.EVENT_FAIL,this.onLoopComplete,this)),this.addParams(),this.runFor()},e.prototype.break=function(){this._isRunning=!1,this.loopTask&&this.loopTask.stop(),this.complete()},e.prototype.complete=function(){this.removeParams(),t.prototype.complete.call(this)},e.prototype.injectParams=function(t){t&&t.length&&(this._paramIds=t)},e.prototype.runFor=function(){if(this._totalTimes>0&&this._curTimes<this._totalTimes-1)if(this.loopTask){if(this._curTimes++,this.component&&this.component.vfStage){var t=this.component.vfStage.variableManager.getGlobalVariable(this._paramId);t&&(t.value=this._curTimes)}this.loopTask.run()}else this.complete();else this.complete()},e.prototype.getforin=function(){if(this.component.vfStage){var t=this.component.vfStage.variableManager.getExpressItemValue(this.component,this.data.forin);return Array.isArray(t)?t.length:parseInt(t,10)}return 0},e.prototype.onLoopComplete=function(){this.runFor()},e.prototype.addParams=function(){if(this.component&&this.component.vfStage){var t=this.component.vfStage.variableManager,e=t.getFunctionId()+"_for";if(this._paramId=e,t.variableMap[K.GLOBAL_ID]||(t.variableMap[K.GLOBAL_ID]={}),t.variableMap[K.GLOBAL_ID][e]={id:e,type:"object",value:0},this.loopTask){var n=this._paramIds.concat([this._paramId]);At(this.loopTask,n)}}},e.prototype.removeParams=function(){if(this.component&&this.component.vfStage){var t=this.component.vfStage.variableManager,e=this._paramId;delete t.variableMap[K.GLOBAL_ID][e]}},e}(f),yt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),gt=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.data=n,o}return yt(e,t),Object.defineProperty(e.prototype,"target",{get:function(){return Y(this.component,this.data.target)},enumerable:!1,configurable:!0}),e.prototype.run=function(){if(t.prototype.run.call(this),this.component.vfStage){var e=this.component.vfStage.variableManager,n=this.target,o=this.data.name;Array.isArray(o)&&(o=e.getExpressItemValue(this.component,o));var r=[];if(this.data.params)for(var i=0,a=this.data.params.length;i<a;i++){var s=e.getExpressItemValue(this.component,this.data.params[i]);r.push(s)}n&&o&&n[o]&&n[o].apply(n,r)}this.complete()},e}(p),_t=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),bt=function(t){function e(e,n){var o=t.call(this)||this;return o.runId=-1,o._loopComplete=!1,o.data=n,o.component=e,o.eventName=n.event,o.system=!0===n.system,o.global=!0===n.global,o.funName=n.funName,o}return _t(e,t),e.prototype.run=function(){if(t.prototype.run.call(this),this._loopComplete=!0,0===this.loopTask.tasks.length&&this.component&&this.funName){this.callfunData={type:12,name:this.funName,params:[]};var e=new ht(this.component,this.funName,this.callfunData);this.callfun=e,this.loopTask.addTask(e)}if(this.loopTask&&(this.loopTask.off(s.EVENT_COMPLETE,this.onLoopComplete,this),this.loopTask.on(s.EVENT_COMPLETE,this.onLoopComplete,this)),this.component)if(this.system)(n=this.component.vfStage)&&(n.systemEvent.off(this.eventName,this.onTriger,this),n.systemEvent.on(this.eventName,this.onTriger,this));else if(this.global){var n;(n=this.component.vfStage)&&(n.off(this.eventName,this.onTriger,this),n.on(this.eventName,this.onTriger,this))}else this._component=Y(this.component,this.data.target),this._component&&(this._component.off(this.eventName,this.onTriger,this),this._component.on(this.eventName,this.onTriger,this));this.complete()},e.prototype.stop=function(){if(this.complete(),this.component)if(this.system)(e=this.component.vfStage)&&e.systemEvent.off(this.eventName,this.onTriger,this);else if(this.global){var e;(e=this.component.vfStage)&&e.off(this.eventName,this.onTriger,this)}else this._component&&this._component.off(this.eventName,this.onTriger,this);this.loopTask&&(this.loopTask.off(s.EVENT_COMPLETE,this.onLoopComplete,this),this.loopTask.complete()),t.prototype.stop.call(this)},e.prototype.break=function(){this.complete(),t.prototype.break.call(this)},e.prototype.onLoopComplete=function(){this._loopComplete=!0},e.prototype.onSystemTriger=function(t){t.code===this.eventName&&this.onTriger(t)},e.prototype.onTriger=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._isPaused||(t&&t.length>0&&this.callfunData&&(this.callfunData.params=t),this.loopTask&&this._loopComplete&&(this._loopComplete=!1,this.loopTask.run()))},e}(f),Tt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Et=function(t){function e(e,n){var o=t.call(this)||this;return o._loopComplete=!1,o.component=e,o.data=n,o.eventName=n.event,o.system=!0===n.system,o.global=!0===n.global,o}return Tt(e,t),e.prototype.run=function(){if(t.prototype.run.call(this),this.component)if(this.system)(e=this.component.vfStage)&&e.systemEvent.off(this.eventName);else if(this.global){var e;(e=this.component.vfStage)&&e.off(this.eventName)}else this._component=Y(this.component,this.data.target),this._component&&this._component.off(this.eventName);this.complete()},e}(p),Ot=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),St=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.data=n,o.eventName=n.event,o.eventData=n.eventData,o.system=!0===n.system,o.global=!0===n.global,o}return Ot(e,t),e.prototype.run=function(){t.prototype.run.call(this);var e=this.component;if(e){var n=this.getEmitEventData();if(this.system){if(e.vfStage){var o=e.vfStage.systemEvent;"object"==typeof n?(n.type=this.eventName,"message"!==this.eventName&&o.emit(this.eventName,n),o.emit("message",n)):o.emitError("S0003",[this.eventName,JSON.stringify(n)],"warning",this)}}else this.global?e.vfStage&&e.vfStage.emit(this.eventName,n):(this.target=Y(this.component,this.data.target),this.target&&this.target.emit(this.eventName,n))}this.complete()},e.prototype.stop=function(){this.complete(),t.prototype.stop.call(this)},e.prototype.break=function(){this.complete(),t.prototype.break.call(this)},e.prototype.getEmitEventData=function(){if(Array.isArray(this.eventData)&&this.component){var t=this.component.vfStage;if(t)return t.variableManager.getExpressItemValue(this.component,this.eventData)}return this.eventData},e}(p);function At(t,e){var n=t.tasks;if(n)for(var o=0,r=n.length;o<r;o++)wt(n[o],e)}function wt(t,e){if(t instanceof nt)Pt(t.data.express,e);else if(t instanceof rt){for(var n=t.conditions,o=0,r=n.length;o<r;o++){Pt(n[o],e)}if(t.conditionsRun)for(var i=t.conditionsRun,a=0,s=i.length;a<s;a++){At(i[a],e)}t.elseRun&&At(t.elseRun,e)}else t instanceof tt?t.data.value&&Array.isArray(t.data.value)&&xt(t.data.value,e):t instanceof ct?(t.data.name&&Array.isArray(t.data.name)&&xt(t.data.name,e),t.data&&t.data.target&&xt(t.data.target,e)):t instanceof ut?t.data.assetId&&Array.isArray(t.data.assetId)&&xt(t.data.assetId,e):t instanceof ht?(t.data&&t.data.params&&Pt(t.data.params,e),t.data&&t.data.target&&xt(t.data.target,e)):t instanceof mt?t.data&&t.data.value&&xt(t.data.value,e):t instanceof vt?t.injectParams(e):(t instanceof Z||t instanceof bt||t instanceof Et||t instanceof St||t instanceof gt)&&t.data&&t.data.target&&xt(t.data.target,e)}function Pt(t,e){if(t&&Array.isArray(t))for(var n=0,o=t.length;n<o;n++){xt(t[n],e)}}function xt(t,e){if(t[0]===o.PARAM_VALUE){var n=t[1];e.length>n&&(t[2]=e[n])}else t[0]===o.ARRAY_VALUE?Array.isArray(t[3])&&xt(t[3],e):t[0]===o.ARRAY_FUNCTION&&("push"==t[3]||"unshift"==t[3]||"concat"==t[3]?Array.isArray(t[4])&&xt(t[4],e):"splice"==t[3]&&(Array.isArray(t[4])&&xt(t[4],e),Array.isArray(t[5])&&xt(t[5],e)))}var kt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ct=function(t){function e(e,n){var o=t.call(this)||this;return o.callTargets=[],o._loopComplete=!1,o._component=e,o.funName=n,o}return kt(e,t),e.prototype.injectParams=function(t){this.loopTask&&At(this.loopTask,t)},e.prototype.runWithId=function(t){this._isRunning||(this.callTargets.push(t),this.run())},e.prototype.stopWithId=function(t){var e=this.callTargets.indexOf(t);e>=0&&(e>0?this.callTargets.splice(e,1):(this.callTargets.splice(e,1),this._isRunning&&this.loopTask.stop()))},e.prototype.breakWithId=function(t){var e=this.callTargets.indexOf(t);e>=0&&(e>0?this.callTargets.splice(e,1):(this.callTargets.splice(e,1),this._isRunning&&this.loopTask.break()))},e.prototype.run=function(){t.prototype.run.call(this),this._loopComplete=!0,this.loopTask&&(this.loopTask.on(s.EVENT_COMPLETE,this.onLoopComplete,this),this.loopTask.on(s.EVENT_BREAK,this.onBreak,this)),this.callTargets.length>0?this.loopTask.run():this.complete()},e.prototype.stop=function(){this.complete(),t.prototype.stop.call(this)},e.prototype.break=function(){this.complete(),t.prototype.break.call(this)},e.prototype.complete=function(){this.callTargets.length=0,this.loopTask.off(s.EVENT_COMPLETE,this.onLoopComplete,this),this.loopTask.off(s.EVENT_BREAK,this.onBreak,this),t.prototype.complete.call(this)},e.prototype.onLoopComplete=function(){if(this.callTargets.length>0){var t=this.callTargets[0];this.callTargets.shift(),this._isRunning=!1,this.emit(s.FUNCTION_RUN_COMPLETE,t)}this.callTargets.length>0?this.loopTask.run():this.complete()},e}(f),It=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Mt=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.transition=n,o}return It(e,t),e.prototype.run=function(){var e;t.prototype.run.call(this);var n=this.component.vfStage;n?((null===(e=n.syncManager)||void 0===e?void 0:e.resumeStatusFlag)||n.switchToNextScene(this.transition),this.complete()):this.complete()},e}(p),Lt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Nt=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.transition=n,o}return Lt(e,t),e.prototype.run=function(){var e;t.prototype.run.call(this);var n=this.component.vfStage;n?((null===(e=n.syncManager)||void 0===e?void 0:e.resumeStatusFlag)||n.switchToPrevScene(this.transition),this.complete()):this.complete()},e}(p),jt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Rt=function(t){function e(e,n,o){var r=t.call(this)||this;return r.component=e,r.sceneId=n,r.transition=o,r}return jt(e,t),e.prototype.run=function(){var e;t.prototype.run.call(this);var n=this.component.vfStage;n?((null===(e=n.syncManager)||void 0===e?void 0:e.resumeStatusFlag)||n.switchToSceneId(this.sceneId,this.transition),this.complete()):this.complete()},e}(p),Ft=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Vt=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.data=n,o}return Ft(e,t),e.prototype.run=function(){if(t.prototype.run.call(this),this.component.vfStage&&this.data.target){var e=this.component.vfStage.variableManager.getVariableByData(this.component,this.data.target);e&&e.value.pop()}this.complete()},e}(p),Dt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Bt=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.data=n,o}return Dt(e,t),e.prototype.run=function(){if(t.prototype.run.call(this),this.component.vfStage&&this.data.target){var e=this.component.vfStage.variableManager.getVariableByData(this.component,this.data.target);if(e)e.value.push(this.data.value)}this.complete()},e}(p),Ut=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Gt=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.data=n,o}return Ut(e,t),e.prototype.run=function(){if(t.prototype.run.call(this),this.component.vfStage&&this.data.target){var e=this.component.vfStage.variableManager.getVariableByData(this.component,this.data.target);if(e){var n=this.data.value;void 0!==n?e.value.splice(this.data.start,this.data.deleteCount||0,n):e.value.splice(this.data.start,this.data.deleteCount||0)}}this.complete()},e}(p),Xt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Yt=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.data=n,o}return Xt(e,t),e.prototype.run=function(){if(t.prototype.run.call(this),this.component.vfStage&&this.data.target){var e=this.component.vfStage.variableManager,n=e.getVariableByData(this.component,this.data.target);if(n){var o=n.value;e.shuffle(o)}}this.complete()},e}(p),Ht=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),zt=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.data=n,o}return Ht(e,t),e.prototype.run=function(){if(t.prototype.run.call(this),this.component.vfStage&&this.data.target){var e=this.component.vfStage.variableManager.getVariableByData(this.component,this.data.target);e&&(e.value=this.data.value)}this.complete()},e}(p),Kt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),$t=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.data=n,o}return Kt(e,t),e.prototype.run=function(){if(t.prototype.run.call(this),this.component.vfStage&&this.data.target){var e=this.component.vfStage.variableManager,n=e.getVariableByData(this.component,this.data.target),o=e.getVariableByData(this.component,this.data.concatArr);n&&o&&(this.data.value?n.value=o.value.concat(this.data.value):n.value=o.value.concat())}this.complete()},e}(p),Wt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Jt=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.data=n,o}return Wt(e,t),e.prototype.run=function(){if(t.prototype.run.call(this),this.component.vfStage&&this.data.target){var e=this.component.vfStage.variableManager.getVariableByData(this.component,this.data.target);e&&e.value.shift()}this.complete()},e}(p),qt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Zt=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.data=n,o}return qt(e,t),e.prototype.run=function(){if(t.prototype.run.call(this),this.component.vfStage&&this.data.target){var e=this.component.vfStage.variableManager.getVariableByData(this.component,this.data.target);if(e)e.value.unshift(this.data.value)}this.complete()},e}(p),Qt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),te=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.data=n,o}return Qt(e,t),e.prototype.run=function(){if(t.prototype.run.call(this),this.component&&this.component.vfStage){var e=this.component.vfStage.variableManager,n=Y(this.component,this.data.target),o=z(this.data.value);n?e.addVariableDataToComponent(n,this.data.varId,this.data.variableType,o):e.addVariableDataToGlobal(this.data.varId,this.data.variableType,o)}this.complete()},e}(p),ee=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ne=function(t){function e(){return t.call(this)||this}return ee(e,t),e.prototype.run=function(){t.prototype.run.call(this),this.break(),this.complete()},e}(p),oe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),re=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.data=n,o}return oe(e,t),Object.defineProperty(e.prototype,"timeout",{get:function(){var t=0;Array.isArray(this.data.value)?this.component&&this.component.vfStage&&(t=this.component.vfStage.variableManager.getExpressItemValue(this.component,this.data.value)):t=this.data.value;return H(t)||(t=1),t},enumerable:!1,configurable:!0}),e.prototype.run=function(){var e=this;t.prototype.run.call(this);var n=this.timeout;this.timeoutHandler=vf.gui.Scheduler.setTimeout(n,(function(){e.timeoutHandler&&(e.timeoutHandler.stop(),e.timeoutHandler=void 0),e.complete()}))},e}(p),ie=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ae=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.data=n,o}return ie(e,t),Object.defineProperty(e.prototype,"timeout",{get:function(){var t=0;Array.isArray(this.data.value)?this.component&&this.component.vfStage&&(t=this.component.vfStage.variableManager.getExpressItemValue(this.component,this.data.value)):t=this.data.value;return H(t)||(t=1),t},enumerable:!1,configurable:!0}),e.prototype.run=function(){var e=this;t.prototype.run.call(this);var n=this.timeout;this.timeoutHandler=vf.gui.Scheduler.setTimeout(n,(function(){e.timeoutHandler&&(e.timeoutHandler.stop(),e.timeoutHandler=void 0),e.loopTask&&e.loopTask.run()})),this.complete()},e.prototype.stop=function(){t.prototype.stop.call(this),this.complete(),this.timeoutHandler&&this.timeoutHandler.stop()},e}(f),se=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ce=function(t){function e(e,n){var o=t.call(this)||this;return o.lastTimes=0,o.loopTaskComplete=!0,o.intervalComplete=!0,o._timeout=0,o._times=1,o.component=e,o.data=n,o}return se(e,t),Object.defineProperty(e.prototype,"timeout",{get:function(){var t=0;Array.isArray(this.data.value)?this.component&&this.component.vfStage&&(t=this.component.vfStage.variableManager.getExpressItemValue(this.component,this.data.value)):t=this.data.value;return H(t)||(t=1),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"times",{get:function(){var t=0;Array.isArray(this.data.times)?this.component&&this.component.vfStage&&(t=this.component.vfStage.variableManager.getExpressItemValue(this.component,this.data.times)):t=void 0===this.data.times?0:this.data.times;return H(t)||(t=0),t},enumerable:!1,configurable:!0}),e.prototype.run=function(){t.prototype.run.call(this),this._timeout=this.timeout,this._times=this.times,this.lastTimes=this._times,this.loopTask&&this.loopTask.addListener(s.EVENT_COMPLETE,this.onLoopComplete,this),this.runOnce(this._timeout,this._times)},e.prototype.complete=function(){t.prototype.complete.call(this),this.timeoutHandler&&(this.timeoutHandler.stop(),this.timeoutHandler=void 0),this.loopTask&&this.loopTask.removeListener(s.EVENT_COMPLETE,this.onLoopComplete,this)},e.prototype.stop=function(){t.prototype.stop.call(this),this.complete()},e.prototype.resume=function(){this._isPaused&&this.loopTaskComplete&&this.intervalComplete&&this.checkComplete(this._timeout,this._times),t.prototype.resume.call(this)},e.prototype.onLoopComplete=function(){this.loopTaskComplete=!0,this.intervalComplete&&this.checkComplete(this._timeout,this._times)},e.prototype.runOnce=function(t,e){var n=this;this.intervalComplete=!1,void 0===this.timeoutHandler?this.timeoutHandler=vf.gui.Scheduler.setTimeout(t,(function(){n.intervalComplete=!0,n.timeoutHandler&&n.timeoutHandler.stop(),n.loopTaskComplete&&n.intervalComplete&&n.checkComplete(t,e)})):this.timeoutHandler.restart()},e.prototype.checkComplete=function(t,e){if(!this._isPaused&&!this._isCompleted){e>0&&!(this.lastTimes>0)?this.complete():(this.lastTimes--,this.loopTask?(this.loopTaskComplete=!1,this.runOnce(t,e),this.loopTask.run()):this.complete())}},e}(f),pe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ue=function(t){function e(e,n){var o=t.call(this)||this;return o.loopTaskComplete=!0,o.component=e,o.data=n,o}return pe(e,t),e.prototype.run=function(){if(t.prototype.run.call(this),this.component){var e=this.component.vfStage;e&&e.app?(this.loopTask&&this.loopTask.addListener(s.EVENT_COMPLETE,this.onLoopComplete,this),this.tickHandler?this.tickHandler.restart():this.tickHandler=vf.gui.Scheduler.setEnterFrame(this.tick.bind(this))):this.complete()}else this.complete()},e.prototype.complete=function(){t.prototype.complete.call(this),this.loopTask&&this.loopTask.removeListener(s.EVENT_COMPLETE,this.onLoopComplete,this),this.tickHandler&&this.tickHandler.stop()},e.prototype.stop=function(){t.prototype.stop.call(this),this.complete()},e.prototype.pause=function(){t.prototype.pause.call(this),this.tickHandler&&this.tickHandler.pause()},e.prototype.resume=function(){this._isPaused&&this.tickHandler&&this.tickHandler.resume(),t.prototype.resume.call(this)},e.prototype.onLoopComplete=function(){this.loopTaskComplete=!0},e.prototype.tick=function(){this.loopTaskComplete&&this.loopTask&&this.loopTask.run()},e}(f),le=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),he=function(t){function e(e,n){var o=t.call(this)||this;if(o.loopTaskComplete=!0,o.curTime=0,o.lastTime=0,o.component=e,o.data=n,o.funName=n.funName,o.funName){o.callfunData={type:12,name:o.funName,params:[]};var r=new ht(o.component,o.funName,o.callfunData);o.callfun=r,o.loopTask.addTask(r)}return o}return le(e,t),e.prototype.run=function(){if(t.prototype.run.call(this),this.component){var e=this.component.vfStage;e&&e.app?(this.loopTask&&this.loopTask.addListener(s.EVENT_COMPLETE,this.onLoopComplete,this),this.curTime=(new Date).getTime(),this.lastTime=this.curTime,e.app.ticker.add(this.tick,this)):this.complete()}else this.complete()},e.prototype.complete=function(){if(t.prototype.complete.call(this),this.loopTask&&this.loopTask.removeListener(s.EVENT_COMPLETE,this.onLoopComplete,this),this.component){var e=this.component.vfStage;e&&e.app&&e.app.ticker.remove(this.tick,this)}},e.prototype.stop=function(){t.prototype.stop.call(this),this.complete()},e.prototype.pause=function(){if(t.prototype.pause.call(this),this.component){var e=this.component.vfStage;e&&e.app&&e.app.ticker.remove(this.tick,this)}},e.prototype.resume=function(){if(this._isPaused&&this.component){var e=this.component.vfStage;e&&e.app&&e.app.ticker.add(this.tick,this)}t.prototype.resume.call(this)},e.prototype.onLoopComplete=function(){this.loopTaskComplete=!0},e.prototype.tick=function(){if(this.loopTaskComplete&&this.loopTask){this.curTime=(new Date).getTime();var t=this.curTime-this.lastTime;this.callfunData&&(this.callfunData.params=[t]),this.loopTaskComplete=!1,this.loopTask.run(),this.lastTime=this.curTime}},e}(f),fe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),me=function(t){function e(e,n){var o=t.call(this)||this;return o.component=e,o.data=n,o}return fe(e,t),e.prototype.run=function(){var t,e=null===(t=this.component.vfStage.variableManager.getGlobalVariable("$accessOption"))||void 0===t?void 0:t.value;if(e&&2!==e.role){var n=Y(this.component,this.data.target);n&&(n.visible=!1)}this.complete()},e}(p),de=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ve=function(t){function e(e,n){var o=t.call(this)||this;return o.trackId=0,o.component=e,o.data=n,o._synchronous=n.sync||!1,o}return de(e,t),e.prototype.run=function(){t.prototype.run.call(this);var e=this.getTargetComponent();e.on("AnimationComplete",this.onAnimationComplete,this),e.play(this.data.name,void 0,this.trackId)},e.prototype.stop=function(){t.prototype.stop.call(this);var e=this.getTargetComponent();e&&e.off("AnimationComplete",this.onAnimationComplete,this)},e.prototype.break=function(){this.getTargetComponent().gotoEnd(this.data.name,this.trackId),t.prototype.break.call(this)},e.prototype.onAnimationComplete=function(t){t.name===this.data.name&&(this.getTargetComponent().off("AnimationComplete",this.onAnimationComplete,this),this.complete())},e.prototype.getTargetComponent=function(){if(this._component)return this._component;var t=X(this.component,this.data.target);return t instanceof y?(this._component=t,t):this.component},e}(p),ye=function(t){function e(e,n,o){var r=t.call(this)||this;return r._animationList=new l,r._AnimationCompleteArray=[],r.bingKeydown=r.onKeydown.bind(r),r._synchronous=!0,r.component=n,r.actionList=e,r.data=o,r.parsea(r.data),r}return de(e,t),Object.defineProperty(e.prototype,"animationList",{get:function(){return this._animationList},enumerable:!1,configurable:!0}),e.prototype._run=function(){var t=this._animationList;t.isRunning?t.tasks.forEach((function(t){t.break()})):t.run()},e.prototype.run=function(){t.prototype.run.call(this),this.addEvent()},e.prototype.complete=function(){this.removeEvent(),t.prototype.complete.call(this)},e.prototype.onAnimationRun=function(){var t=this._animationList,e=t.getNextTask();e&&!e.synchronous&&t.nextTask()},e.prototype.onAnimationComplete=function(t){var e=this._AnimationCompleteArray;e.push(t.data.name),e.length===this.data.animations.length&&(e.length=0,this.complete())},e.prototype.parsea=function(t){var e=this,n=1;this._AnimationCompleteArray.length=0,void 0===t.continue&&(t.continue={pointer:["click"],keys:["Space","Enter","ArrowRight"]}),void 0===t.back&&(t.back={pointer:["rightdown"],keys:["ArrowLeft"]}),t.animations.forEach((function(t){var o=new ve(e.component,t);o.on(s.EVENT_RUN,e.onAnimationRun,e),o.on(s.EVENT_COMPLETE,e.onAnimationComplete,e),o.on(s.EVENT_BREAK,e.onAnimationComplete,e),t.sync||(n++,o.trackId=n-1),e._animationList.addTask(o)}))},e.prototype.addEvent=function(){var t=this.component;t.interactive=!0,t.interactabled=!0,t.hitArea.width=4e3,t.hitArea.height=4e3,t.hitArea.updataHitArea(),t.on("click",this.onClick,this),t.on("rightdown",this.onRightdown,this),window.removeEventListener("keydown",this.bingKeydown),window.addEventListener("keydown",this.bingKeydown)},e.prototype.removeEvent=function(){this.component.off("click",this.onClick,this),this.component.off("rightdown",this.onRightdown,this),window.removeEventListener("keydown",this.bingKeydown)},e.prototype.onClick=function(){this._run()},e.prototype.onRightdown=function(){this._run()},e.prototype.onKeydown=function(t){var e,n,o=null===(e=this.data.continue)||void 0===e?void 0:e.keys,r=null===(n=this.data.back)||void 0===n?void 0:n.keys;o&&r&&(-1!==o.indexOf(t.code)?this._run():r.indexOf(t.code))},e}(p),ge=function(){function t(t,e){this._asynchronousList=[],this._synchronousList=new l,this.component=t,this.data=e,this.parseData()}return Object.defineProperty(t.prototype,"actionList",{get:function(){return this._asynchronousList},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"synchronousList",{get:function(){return this._synchronousList},enumerable:!1,configurable:!0}),t.prototype.run=function(){this._asynchronousList.forEach((function(t){t.run()})),this.synchronousList.run()},t.prototype.stop=function(){this._asynchronousList.forEach((function(t){t.stop()})),this.synchronousList.stop()},t.prototype.pause=function(){this._asynchronousList.forEach((function(t){t.pause()})),this.synchronousList.pause()},t.prototype.resume=function(){this._asynchronousList.forEach((function(t){t.resume()})),this.synchronousList.resume()},t.prototype.parseData=function(){this.data&&Array.isArray(this.data)&&this.parseAST(this.data)},t.prototype.addGlobalVariable=function(t){this.component&&this.component.vfStage&&this.component.vfStage.variableManager.addVariableDataToGlobal(t.varId,t.variableType,t.value)},t.prototype.parseAST=function(t){var e=this;t&&t.forEach((function(t){var n=e.parseAction(t);n&&(n.synchronous?e._synchronousList.addTask(n):e._asynchronousList.push(n))}))},t.prototype.parseAction=function(t){var e;switch(t.type){case 50:e=new ye(this,this.component,t);break;case 1:e=this.parseAddToStageBefore(t);break;case 2:e=this.parseAddToStage(t);break;case 4:e=this.parseSetProperty(t);break;case 5:e=this.parseClick(t);break;case 6:e=this.parseExpress(t);break;case 7:e=this.parseIf(t);break;case 11:e=this.parseDefineFunction(t);break;case 12:e=this.parseCallFunction(t);break;case 0:e=this.parsePrint(t);break;case 13:e=this.parseAddEventListener(t);break;case 14:e=this.parseRemoveEventListener(t);break;case 15:e=this.parseEmitEvent(t);break;case 16:case 33:case 34:case 46:case 47:e=this.parseSound(t);break;case 17:e=this.parsePlayAnimation(t);break;case 18:e=this.parseJumpToNextScene(t);break;case 19:e=this.parseJumpToPrevScene(t);break;case 20:e=this.parseJumpToScene(t);break;case 21:e=new zt(this.component,t);break;case 22:e=new Vt(this.component,t);break;case 23:e=new Bt(this.component,t);break;case 24:e=new Gt(this.component,t);break;case 25:e=new Yt(this.component,t);break;case 26:e=new $t(this.component,t);break;case 27:e=new Jt(this.component,t);break;case 28:e=new Zt(this.component,t);break;case 29:e=this.parseAddEventListenerCall(t);break;case 37:e=new te(this.component,t);break;case 30:e=new gt(this.component,t);break;case 31:var n=t,o={type:30,target:n.target,name:"gotoPlay",params:[]};Array.isArray(n.name)?o.params.push(n.name):o.params.push([0,n.name]),Array.isArray(n.frame)?o.params.push(n.frame):o.params.push([0,n.frame]),Array.isArray(n.times)?o.params.push(n.times):o.params.push([0,n.times]),Array.isArray(n.trackId)?o.params.push(n.trackId):o.params.push([0,n.trackId||0]),e=new gt(this.component,o);break;case 32:var r=t,i={type:30,target:r.target,name:"gotoStop",params:[]};Array.isArray(r.name)?i.params.push(r.name):i.params.push([0,r.name]),Array.isArray(r.frame)?i.params.push(r.frame):i.params.push([0,r.frame]),e=new gt(this.component,i);break;case 38:e=this.parseFor(t);break;case 39:e=new ne;break;case 40:e=new re(this.component,t);break;case 41:e=this.parseSetTimeout(t);break;case 42:e=this.parseSetInterval(t);break;case 43:e=this.parseEnterFrame(t);break;case 44:e=this.parseEnterFrameCall(t);break;case 48:e=this.parseCustom(t);break;case 49:e=this.parseTeacherVisible(this.component,t)}return e},t.prototype.parseSubTask=function(t,e){if(e.execute)for(var n=0,o=e.execute.length;n<o;n++){var r=e.execute[n],i=this.parseAction(r);i&&t.addSubTask(i)}},t.prototype.parseAddToStageBefore=function(t){var e=new Z(this.component,{type:13,event:"Add",target:[]});return this.parseSubTask(e,t),e},t.prototype.parseAddToStage=function(t){var e=new Z(this.component,{type:13,event:"Added",target:[]});return this.parseSubTask(e,t),e},t.prototype.parseSetProperty=function(t){return new tt(this.component,t)},t.prototype.parseClick=function(t){var e={event:"click",type:13,target:t.target},n=new Z(this.component,e);return this.parseSubTask(n,t),n},t.prototype.parseExpress=function(t){return new nt(this.component,t)},t.prototype.parseIf=function(t){var e=new rt(this.component);if(t.execute)for(var n=0,o=t.execute.length;n<o;n++){var r=t.execute[n];if(8===r.type||9===r.type||10===r.type){var i=r.condition,a=new l;if(r.execute)for(var s=0,c=r.execute.length;s<c;s++){var p=this.parseAction(r.execute[s]);p&&a.addTask(p)}e.addCondition(i,a)}}return e},t.prototype.parseDefineFunction=function(t){var e=new Ct(this.component,t.name);return this.parseSubTask(e,t),new at(this.component,t.name,t,e)},t.prototype.parseCallFunction=function(t){return new ht(this.component,t.name,t)},t.prototype.parsePrint=function(t){return new mt(this.component,t)},t.prototype.parseAddEventListener=function(t){var e=new Z(this.component,t);return this.parseSubTask(e,t),e},t.prototype.parseRemoveEventListener=function(t){return new Et(this.component,t)},t.prototype.parseEmitEvent=function(t){return new St(this.component,t)},t.prototype.parseAddEventListenerCall=function(t){if(t.funName)return new bt(this.component,t)},t.prototype.parseSound=function(t){return new ut(this.component,t)},t.prototype.parsePlayAnimation=function(t){return new ct(this.component,t)},t.prototype.parseJumpToNextScene=function(t){return new Mt(this.component,t.transition)},t.prototype.parseJumpToPrevScene=function(t){return new Nt(this.component,t.transition)},t.prototype.parseJumpToScene=function(t){return new Rt(this.component,t.value,t.transition)},t.prototype.parseFor=function(t){var e=new vt(this.component,t);return this.parseSubTask(e,t),e},t.prototype.parseSetTimeout=function(t){var e=new ae(this.component,t);return this.parseSubTask(e,t),e},t.prototype.parseSetInterval=function(t){var e=new ce(this.component,t);return this.parseSubTask(e,t),e},t.prototype.parseEnterFrame=function(t){var e=new ue(this.component,t);return this.parseSubTask(e,t),e},t.prototype.parseEnterFrameCall=function(t){return new he(this.component,t)},t.prototype.parseCustom=function(t){var e=new d(t.name);return this.parseSubTask(e,t),e},t.prototype.parseTeacherVisible=function(t,e){return new me(t,e)},t}(),_e=function(){function t(){this.type=null,this.frames=[],this.curTime=0,this.lastTime=0,this.loop=!1,this.totalTime=0,this._defaultValue=null,this._globalTime=0,this._lastGlobalTime=0,this._lastFrame=null,this._curFrame=null,this._nextFrame=null,this._times=-1,this._curValue=null}return Object.defineProperty(t.prototype,"defaultValue",{set:function(t){this._defaultValue=t,this._curValue=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"curValue",{get:function(){return this._curValue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"globalTime",{set:function(t){this._globalTime=t,this.tick(),this._lastGlobalTime=t},enumerable:!1,configurable:!0}),t.prototype.getProgress=function(t,e,n,o){void 0===o&&(o=null);var r=0,i=0;(i=r=n===e?0:(t-e)/(n-e),o&&o.length)&&(1===o.length&&(i=function(t,e){var n=0;switch(t){case 0:return 0;case 1:return e;case 2:return-(Math.pow(e-1,2)-1);case 3:return Math.pow(e,2);case 4:return(e/=.5)<1?.5*Math.pow(e,2):-.5*((e-=2)*e-2);case 5:return Math.pow(e,3);case 6:return Math.pow(e-1,3)+1;case 7:return(e/=.5)<1?.5*Math.pow(e,3):.5*(Math.pow(e-2,3)+2);case 8:return Math.pow(e,3);case 9:return-(Math.pow(e-1,4)-1);case 10:return(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2);case 11:return Math.pow(e,5);case 12:return Math.pow(e-1,5)+1;case 13:return(e/=.5)<1?.5*Math.pow(e,5):.5*(Math.pow(e-2,5)+2);case 14:return 1-Math.cos(e*(Math.PI/2));case 15:return Math.sin(e*(Math.PI/2));case 16:return-.5*(Math.cos(Math.PI*e)-1);case 17:return 0===e?0:Math.pow(2,10*(e-1));case 18:return 1===e?1:1-Math.pow(2,-10*e);case 19:return 0===e?0:1===e?1:(e/=.5)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*--e));case 20:return-(Math.sqrt(1-e*e)-1);case 21:return Math.sqrt(1-Math.pow(e-1,2));case 22:return(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1);case 23:return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375;case 24:return e*e*(((n=1.70158)+1)*e-n);case 25:return(e-=1)*e*(((n=1.70158)+1)*e+n)+1;case 26:return n=1.70158,(e/=.5)<1?e*e*((1+(n*=1.525))*e-n)*.5:.5*((e-=2)*e*((1+(n*=1.525))*e+n)+2);case 27:case 28:return-1*Math.pow(4,-8*e)*Math.sin((6*e-1)*(2*Math.PI)/2)+1;case 29:return-1*Math.pow(6,-6*e)*Math.sin((6*e-1)*(2*Math.PI)/2)+1;case 30:return n=1.70158,(e/=.5)<1?e*e*((1+(n*=1.525))*e-n)*.5:.5*((e-=2)*e*((1+(n*=1.525))*e+n)+2);case 31:return e*e*(((n=1.70158)+1)*e-n);case 32:return(e-=1)*e*(((n=1.70158)+1)*e+n)+1;case 33:return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375;case 34:return e<1/2.75?7.5625*e*e:e<2/2.75?2-(7.5625*(e-=1.5/2.75)*e+.75):e<2.5/2.75?2-(7.5625*(e-=2.25/2.75)*e+.9375):2-(7.5625*(e-=2.625/2.75)*e+.984375);case 35:return(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2);case 36:return Math.pow(e,4);case 37:return Math.pow(e,.25);case 38:return-Math.cos(e*Math.PI)/2+.5;case 39:return 1-e;case 40:return-Math.cos(e*Math.PI*(9*e))/2+.5;case 41:return 1-Math.cos(4.5*e*Math.PI)*Math.exp(6*-e);default:return e}}(o[0],r)));return i},t.prototype.tick=function(){this.curTime=this._globalTime,this.loop&&(this._times=Math.floor(this.curTime/this.totalTime),this.curTime=this.curTime-this.totalTime*this._times),this.updateCurFrame(),this.updateCurValue(),this.lastTime=this.curTime},t.prototype.updateCurFrame=function(){if(0!==this.frames.length){this._lastFrame=this._curFrame;var t,e=0;for(e=0,t=this.frames.length;e<t;e++)if(this.frames[e].time>this.curTime)return void(0===e?(this._curFrame=null,this._nextFrame=this.frames[e]):(this._curFrame=this.frames[e-1],this._nextFrame=this.frames[e]));this._curFrame=this.frames[this.frames.length-1],this._nextFrame=this._curFrame}},t.prototype.updateCurValue=function(){if(this._curFrame&&this._nextFrame){var t=this.getProgress(this.curTime,this._curFrame.time,this._nextFrame.time,this._curFrame.curve);this._curValue=this._curFrame.getValue(t,this._nextFrame.value)}},t}(),be=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Te=function(t){function e(){var e=t.call(this)||this;return e.nextFrameIndex=0,e.skipEmit=!1,e._curValue=[],e}return be(e,t),e.prototype.skipNextEmit=function(){this.lastTime=0,this.nextFrame=void 0,this.skipEmit=!0},e.prototype.getProgress=function(t,e,n,o){return void 0===o&&(o=null),t},e.prototype.updateCurFrame=function(){this.frames.length},e.prototype.updateCurValue=function(){this._curValue.length=0,0!==this.frames.length&&(void 0===this.nextFrame&&(this.nextFrame=this.frames[0],this.nextFrameIndex=0),this.skipEmit?this.skipEmit=!1:this.curTime>=this.lastTime?this.curTime>this.nextFrame.time&&this.findEvents(this.nextFrameIndex,!1):this.findEvents(0,!0))},e.prototype.findEvents=function(t,e){if(void 0===e&&(e=!1),e)for(var n=this.nextFrameIndex,o=this.frames.length;n<o;n++){var r=this.frames[n];this.addEvent(r)}for(n=t,o=this.frames.length;n<o;n++){if((r=this.frames[n]).time<this.curTime&&(e||r.time>=this.lastTime))this.addEvent(r);else if(r.time>this.curTime){this.nextFrame=r,this.nextFrameIndex=n;break}this.nextFrameIndex=Number.MAX_VALUE}},e.prototype.addEvent=function(t){if(t.value)for(var e=0,n=t.value.length;e<n;e++)this._curValue.push(t.value[e])},e}(_e),Ee=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Oe=function(t){function e(){var e=t.call(this)||this;return e.startFrameInParentAnimation=null,e.nextFrameIndex=0,e.skipPlay=!1,e.curValues=[],e}return Ee(e,t),e.prototype.skipPlayAnimation=function(){this.lastTime=0,this.nextFrame=void 0,this.skipPlay=!0},Object.defineProperty(e.prototype,"curValue",{get:function(){return this.curValues.pop()},enumerable:!1,configurable:!0}),e.prototype.updateCurFrame=function(){this.frames.length},e.prototype.updateCurValue=function(){this.curValues.length=0,0!==this.frames.length&&(void 0===this.nextFrame&&(this.nextFrame=this.frames[0],this.nextFrameIndex=0),this.skipPlay?this.skipPlay=!1:this.curTime>=this.lastTime?this.curTime>this.nextFrame.time&&this.findFrames(this.nextFrameIndex,!1):this.findFrames(0,!1))},e.prototype.findFrames=function(t,e){if(void 0===e&&(e=!1),e)for(var n=this.nextFrameIndex,o=this.frames.length;n<o;n++){var r=this.frames[n];this.addFrame(r)}for(n=t,o=this.frames.length;n<o;n++){if((r=this.frames[n]).time<this.curTime&&(e||r.time>=this.lastTime))this.addFrame(r);else if(r.time>this.curTime){this.nextFrame=r,this.nextFrameIndex=n;break}this.nextFrameIndex=Number.MAX_VALUE}},e.prototype.addFrame=function(t){this.curValues.push({times:t.value.times,animation:t.value.animation})},e}(_e),Se=function(){function t(t){this.timelines=[],this.fps=30,this.totalTime=0,this.loop=!1,this._curTime=0,this._curFrame=0,this.name=t}return Object.defineProperty(t.prototype,"targetDisplay",{get:function(){return this.target},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"curTime",{set:function(t){this._curTime=t,this._curFrame=this._curTime*this.fps/1e3,this.loop&&(this._curFrame=this._curFrame%this.totalTime);for(var e=0,n=this.timelines.length;e<n;e++)this.timelines[e].globalTime=this._curFrame;this.applyTimeline()},enumerable:!1,configurable:!0}),t.prototype.skipNextEvent=function(){for(var t=0,e=this.timelines.length;t<e;t++){var n=this.timelines[t];n instanceof Te&&n.skipNextEmit(),n instanceof Oe&&n.skipPlayAnimation()}},t.prototype.applyTimeline=function(){if(null!=this.target)for(var t=0,e=this.timelines.length;t<e;t++){var n=this.timelines[t],o=this.targetDisplay,r=n.curValue;switch(n.type){case"x":o.x=r;break;case"y":o.y=r;break;case"scaleX":o.scaleX=r;break;case"scaleY":o.scaleY=r;break;case"rotation":o.rotation=r;break;case"visible":o.visible=r;break;case"alpha":o.alpha=r;break;case"text":o.text=r;break;case"enabled":o.enabled=r;break;case"filterBlur":o.filterBlur=r;break;case"event":var i=r;if(i)for(var a=0,s=i.length;a<s;a++){var c=i[a];o.emit(c.type,c.data)}break;case"path":var p=n.curPos;o.x=p[0],o.y=p[1];break;case"spinePlay":var u=r;if(u)for(a=0,s=u.length;a<s;a++){var l=u[a],h=o;if("play"===l.type){var f=l.data;h.play(f.animation,f.loop)}else h.stop()}break;case"play":var m=r,d=o;m&&(d.stopAnimation(),m.animation&&d.play(m.animation,m.times));break;default:0===n.type.indexOf("filter")?this.applyFilter(o,n.type,r):o[n.type]=r}}},t.prototype.applyFilter=function(t,e,n){for(var o=e.split("."),r=t,i=0,a=o.length;i<a-1;i++){var s=o[i];r&&r[s]&&(r=r[s])}r&&(r[o[o.length-1]]=n)},t}(),Ae=function(){function t(){this.time=-1,this.curve=[],this.value=null}return t.prototype.getValue=function(t,e){return null},t}(),we=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Pe=function(t){function e(){return t.call(this)||this}return we(e,t),e.prototype.getValue=function(t,e){return this.value+(e-this.value)*t},e}(Ae),xe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ke=function(t){function e(){return t.call(this)||this}return xe(e,t),e.prototype.getValue=function(t,e){return this.value},e}(Ae),Ce=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ie=function(t){function e(){return t.call(this)||this}return Ce(e,t),e.prototype.getValue=function(t,e){return this.value},e}(Ae),Me=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Le=function(t){function e(){return t.call(this)||this}return Me(e,t),e.prototype.getValue=function(t,e){var n=this.changeColor2RGB(this.value),o=this.changeColor2RGB(e),r=[Math.round(n[0]+(o[0]-n[0])*t),Math.round(n[1]+(o[1]-n[1])*t),Math.round(n[2]+(o[2]-n[2])*t)];return this.changeRGB2Color(r)},e.prototype.changeColor2RGB=function(t){return[t>>16&255,t>>8&255,t>>0&255]},e.prototype.changeRGB2Color=function(t){return 65536*t[0]+256*t[1]+t[2]},e}(Ae),Ne=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),je=function(t){function e(){return t.call(this)||this}return Ne(e,t),e.prototype.getValue=function(t,e){return this.value},e}(Ae),Re=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Fe=function(t){function e(e){var n=t.call(this)||this;return n.length=0,n.path=document.createElementNS("http://www.w3.org/2000/svg","path"),n.path.setAttribute("d",e),n.length=n.path.getTotalLength(),n}return Re(e,t),Object.defineProperty(e.prototype,"curPos",{get:function(){if(this.path){var t=this.path.getPointAtLength(this._curValue*this.length);return[t.x,t.y]}return[0,0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){var t=this.path.getPointAtLength(this._curValue*this.length-1),e=this.path.getPointAtLength(this._curValue*this.length+1);return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI},enumerable:!1,configurable:!0}),e}(_e),Ve=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),De=function(t){function e(){return t.call(this)||this}return Ve(e,t),e.prototype.getValue=function(t,e){return e},e}(Ae),Be=function(){function t(){this.status=0,this.realFPS=!1,this.curTime=0,this.curPlayTime=0,this.startTime=0,this.passedTime=0,this.minDeltaT=33,this.deltaT=0,this.fps=30,this.curAnimatinName="",this.curAnimatinDuration=0,this.curAnimatinDurationTime=0,this.curAnimationTimes=0,this.curAnimationTotalTime=0,this._curPlayTimes=0,this.curAnimationClips=[],this.completeEvent={type:"AnimationComplete",name:"",time:0,loop:0},this.loopCompleteEvent={type:"AnimationLoopComplete",name:"",time:0,loop:0}}return Object.defineProperty(t.prototype,"curPlayTimes",{set:function(t){t!==this._curPlayTimes&&(this._curPlayTimes=t,this.component&&(this.loopCompleteEvent.loop=t,this.loopCompleteEvent.time=this.curPlayTime,this.component.emit("AnimationLoopComplete",this.loopCompleteEvent),this.curAnimationTimes>0&&this._curPlayTimes>=this.curAnimationTimes&&(this.completeEvent.loop=t,this.completeEvent.time=this.curPlayTime,this.component.emit("AnimationComplete",this.completeEvent))))},enumerable:!1,configurable:!0}),t.prototype.init=function(t,e,n,o,r,i){void 0===r&&(r=30),void 0===i&&(i=!1),this.component=t,this.realFPS=i,r>0&&(this.fps=r),this.minDeltaT=Math.ceil(1e3/this.fps),this.deltaT=0,this.animationConfig=n,o&&(this.curAnimationClips=o.concat()),this.curAnimatinName=e,this.loopCompleteEvent.name=e,this.completeEvent.name=e},t.prototype.getPauseData=function(){if(1===this.status)return{animation:this.curAnimatinName,frame:Math.round(this.curPlayTime*this.fps/1e3),times:this.curAnimationTimes<=0?this.curAnimationTimes:this.curAnimationTimes-this._curPlayTimes}},t.prototype.pause=function(){1===this.status&&(this.pauseData=this.getPauseData(),this.stop(),this.status=2)},t.prototype.resume=function(){2===this.status&&(this.pauseData?this.gotoPlay(this.pauseData.frame,this.pauseData.times):this.stop())},t.prototype.gotoPlay=function(t,e){void 0===e&&(e=1),1===this.status&&this.stop(),this.prePlay(t,e)&&(this.status=1,vf.gui.TickerShared.add(this.tick,this))},t.prototype.gotoStop=function(t){1===this.status&&this.stop(),this.skipNextEvent(),this.prePlay(t,1)&&(this.status=0)},t.prototype.gotoByTimeline=function(t){1===this.status&&this.stop(),this.prePlay(t,1)&&(this.status=0)},t.prototype.play=function(t){void 0===t&&(t=1),this.gotoPlay(0,t)},t.prototype.stop=function(){vf.gui.TickerShared.remove(this.tick,this),this.status=0,this.skipNextEvent()},t.prototype.dispose=function(){this.stop(),this.component=void 0,this.animationConfig=void 0,this.curAnimationClips=[],this.curAnimatinName=""},t.prototype.prePlay=function(t,e){var n=this.animationConfig;return n?(this.curAnimatinDuration=n.totalTime,this.curAnimationTimes=e,this.curAnimationTotalTime=Math.round(this.curAnimatinDuration*this.curAnimationTimes*(1e3/this.fps)),this.curAnimatinDurationTime=Math.round(1e3*this.curAnimatinDuration/this.fps),this.curPlayTime=t*(1e3/this.fps),this.deltaT=0,this.setCurTime(this.curPlayTime),this.startTime=0,this.curTime=this.startTime,this.startTime-=this.curPlayTime,this._curPlayTimes=0,!0):(console.warn("can not find animation:",this.curAnimatinName),!1)},t.prototype.tick=function(){var t=vf.gui.TickerShared.deltaMS;if(this.curTime+=t,this.curPlayTime+=t,this.realFPS){if(this.deltaT+=t,this.deltaT<this.minDeltaT)return this.passedTime=this.curTime-this.startTime,this.curAnimationTimes>0&&this.passedTime>this.curAnimationTotalTime&&this.stop(),void(this.curPlayTimes=Math.floor(this.passedTime/this.curAnimatinDurationTime));for(;this.deltaT>this.minDeltaT;)this.deltaT-=this.minDeltaT}this.curPlayTime>this.curAnimatinDurationTime&&(this.curAnimationTimes<0||this.curAnimationTimes>1&&this._curPlayTimes<this.curAnimationTimes-1)&&(this.curPlayTime=this.curPlayTime%this.curAnimatinDurationTime),this.setCurTime(this.curPlayTime),this.passedTime=this.curTime-this.startTime,this.curAnimationTimes>0&&this.passedTime>this.curAnimationTotalTime&&(this.skipNextEvent(),this.setCurTime(this.curAnimationTotalTime),this.stop()),this.curPlayTimes=Math.floor(this.passedTime/this.curAnimatinDurationTime)},t.prototype.setCurTime=function(t){if(this.curAnimationClips)for(var e=0,n=this.curAnimationClips.length;e<n;e++){this.curAnimationClips[e].curTime=t}},t.prototype.skipNextEvent=function(){if(this.curAnimationClips)for(var t=0,e=this.curAnimationClips.length;t<e;t++){this.curAnimationClips[t].skipNextEvent()}},t}(),Ue=function(){function t(t,e,n,o,r){void 0===r&&(r={}),this.animationMap={},this.animationConfig={},this.status=0,this.curAnimationClips=[],this.fps=30,this.realFPS=!1,this.trackMap={},this.nameTrackMap={},this.STOP_TRACK=0,this.component=t,this.data=e,this.realFPS=o,n>0&&(this.fps=n),this._animationTemplate=r,this.parseData()}return t.prototype.addAnimationClip=function(t){var e=t.name,n=this.animationMap[e];null==n&&(n=[],this.animationMap[e]=n),n.push(t)},t.prototype.playDefaultAnimation=function(){if(1!==this.status)for(var t in this.animationConfig)if(this.animationConfig[t]){var e=this.animationConfig[t];if(e.autoPlay){this.play(t,e.loop?-1:1,0);break}}},t.prototype.pause=function(){for(var t in this.trackMap)if(this.trackMap[t]){var e=this.trackMap[t];1===e.status&&e.pause()}},t.prototype.resume=function(){for(var t in this.trackMap)if(this.trackMap[t]){var e=this.trackMap[t];2===e.status&&e.resume()}},t.prototype.gotoPlayMulit=function(t,e,n,o){if(void 0===e&&(e=0),void 0===n&&(n=1),void 0===o&&(o=0),t)for(var r=0,i=t.length;r<i;r++)this.gotoPlay(t[r],e,n,o+r)},t.prototype.gotoStopMulit=function(t,e){if(t)for(var n=0,o=t.length;n<o;n++)this.gotoStop(t[n],e)},t.prototype.gotoPlay=function(t,e,n,o){void 0===o&&(o=0),o<0&&(o=0);var r=this.getAnimationState(t,e,n,o);return r.gotoPlay(e,n),r},t.prototype.gotoEnd=function(t,e){void 0===e&&(e=0),e<0&&(e=0);var n=this.getAnimationState(t,0,1,e);return n.gotoPlay(this.animationConfig[t].totalTime),n},t.prototype.gotoStop=function(t,e){this.stop(),this.getAnimationState(t,e,1,this.STOP_TRACK).gotoStop(e)},t.prototype.gotoByTimeline=function(t,e){this.stop(),this.getAnimationState(t,e,1,this.STOP_TRACK).gotoByTimeline(e)},t.prototype.play=function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=0),this.gotoPlay(t,0,e,n)},t.prototype.playMulit=function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=0),this.gotoPlayMulit(t,0,e,n)},t.prototype.stop=function(){for(var t in this.trackMap)if(this.trackMap[t]){var e=this.trackMap[t];1===e.status&&e.stop()}},t.prototype.parseData=function(){if(this.component&&this.data)for(var t=0,e=this.data.length;t<e;t++)this.parseAnimation(this.data[t])},t.prototype.parseAnimation=function(t){var e=t.name,n=t.duration||0,o={loop:t.loop,totalTime:n,autoPlay:t.autoPlay};this.animationConfig[e]=o;var r=0;for(var i in t.children)if(t.children[i]){var a=t.children[i],s=void 0;if(s="string"==typeof a?this._animationTemplate[a]:a){var c=this.parseAnimationClip(i,e,s);c&&c.totalTime>r&&(r=c.totalTime)}}(!t.duration||t.duration<=0)&&(t.duration=r,o.totalTime=r)},t.prototype.parseAnimationClip=function(t,e,n){var o,r=t;if(o="event"===r?this.component:this.component.getChildById(r)){var i=new Se(e);i.name=e,i.fps=this.fps,i.target=o,i.totalTime=n.duration||0,i.loop=!!n.loop;for(var a=0,s=0,c=n.timelines.length;s<c;s++){var p=n.timelines[s],u=this.parseTimeline(p);u&&(i.timelines.push(u),u.totalTime>a&&(a=u.totalTime))}return(!i.totalTime||i.totalTime<=0)&&(i.totalTime=a),this.addAnimationClip(i),i}},t.prototype.parseTimeline=function(t){var e;switch(t.type){case"x":case"y":case"scaleX":case"scaleY":case"rotation":case"skewX":case"skewY":case"alpha":case"progress":case"volume":case"filterBlur":e=new _e,this.parseFrames(e,t.frames,Pe);break;case"visible":case"enabled":e=new _e,this.parseFrames(e,t.frames,ke);break;case"text":e=new _e,this.parseFrames(e,t.frames,Ie);break;case"color":e=new _e,this.parseFrames(e,t.frames,Le);break;case"event":case"spinePlay":e=new Te,this.parseFrames(e,t.frames,je);break;case"path":t.path&&(e=new Fe(t.path),this.parseFrames(e,t.frames,Pe));break;case"play":e=new Oe,this.parseFrames(e,t.frames,De);break;default:e=new _e,this.parseFrames(e,t.frames,Pe)}return e&&(e.type=t.type,e.loop=!!t.loop,t.frames&&t.frames.length?e.totalTime=t.frames[t.frames.length-1].frame:e.totalTime=0),e},t.prototype.parseFrames=function(t,e,n){for(var o=0,r=e.length;o<r;o++){var i=e[o],a=new n;a.time=i.frame,a.curve=i.curve,a.value=i.value,t.frames.push(a)}},t.prototype.getAnimationState=function(t,e,n,o){var r,i=this.nameTrackMap[t];void 0!==i&&(r=this.trackMap[i]),r&&1===r.status&&r.dispose(),(r=this.trackMap[o])?1===r.status&&r.dispose():(r=new Be,this.trackMap[o]=r);var a=this.animationConfig[t],s=this.animationMap[t];return r.init(this.component,t,a,s,this.fps,this.realFPS),r},t}();function Ge(t,e){return void 0===e&&(e=""),e&&-1===t.indexOf("http")&&-1===t.indexOf("//")&&(t=e+t),t}function Xe(t){return URL.createObjectURL(function(t){for(var e=t.split(","),n=e[0].match(/:(.*?);/)[1],o=atob(e[1]),r=o.length,i=new Uint8Array(r);r--;)i[r]=o.charCodeAt(r);return new Blob([i],{type:n})}(t))}var Ye={degradeDevice:[{name:"iPad2"},{name:"iPad3"}],urlImageScale:100,urlImageAliFormat:"",urlImageTenFormat:"null",videoForceElementDraw:!1,frameRate:30,resolution:window.devicePixelRatio||1,hideVideo:!1,antialias:!0};function He(){var t,e=vf.utils.getSystemInfo().device,n=vf.utils.getSystemInfo().os,o=parseFloat(n.version)||1;return Ye.degradeDevice.forEach((function(n){void 0===n.version&&(n.version=0),n.name===e.name&&o>=n.version&&(t=n)})),t}function ze(t,e){var n=t.scenes;if(n){if((void 0===e||""===e)&&n[0])return n[0];e=null==e?void 0:e.toString();for(var o=0,r=n.length;o<r;o++)if(n[o].id.toString()===e)return n[o]}}var Ke,$e=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),We=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function a(t){try{c(o.next(t))}catch(t){i(t)}}function s(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))},Je=function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},qe=function(t){function e(e){var n=t.call(this)||this;return n.vfResources={},n.vfActions=[],n._resources=[],n._sceneMap={},n._loadNum=0,n._isLoadScript=!1,n._isLoadResource=!1,vf.gui.Utils.setSourcePath(n.getImageAsset.bind(n)),vf.gui.Utils.setDisplayObjectPath(n.getDisplayObject.bind(n)),n.stage=e,n.initGlobalVariable(),n}return $e(e,t),Object.defineProperty(e.prototype,"data",{get:function(){if(this.stage)return this.stage.data},enumerable:!1,configurable:!0}),e.prototype.destroyVfResourcesItem=function(t){if(this.vfResources&&this.vfResources[t]){var e=this.vfResources[t];e.texture?e.texture.destroy(!0):e.sound?e.sound.media&&e.sound.destroy():e.data instanceof ArrayBuffer?e.data=void 0:e.spritesheet&&e.spritesheet.destroy(),delete this.vfResources[t]}},e.prototype.destroyVfResources=function(){if(this._loader&&this._loader.reset(),this.vfResources)for(var t in this.vfResources)this.destroyVfResourcesItem(t);this._resources=[]},e.prototype.destroy=function(){this.destroyVfResources(),vf.utils.destroyTextureCache(),vf.utils.clearTextureCache(),vf.AudioEngine.Ins().map.forEach((function(t){t.dispose()})),this._loader&&this._loader.destroy(),this.stage=void 0,this._sceneMap={},vf.gui.Utils.setSourcePath(void 0),vf.gui.Utils.setDisplayObjectPath(void 0)},e.prototype.loadData=function(t,e,n){return We(this,void 0,void 0,(function(){var o,r,i;return Je(this,(function(a){switch(a.label){case 0:for(o=t.length-1;o>=0;--o)r=t[o].id,this.vfResources[r]&&t.splice(o,1);return 0!==t.length||0!==e.length?[3,1]:(this.emit("LoadComplete",!0),[3,5]);case 1:return i=this.stage,this._isLoadScript=!1,this._isLoadResource=!1,this.data?[4,this.loadAllScript(i,e,n)]:[3,3];case 2:a.sent(),a.label=3;case 3:return this.data?[4,this.loadAllAsset(i,t,n)]:[3,5];case 4:a.sent(),a.label=5;case 5:return[2]}}))}))},e.prototype.createScene=function(t,e){var n=ze(this.data,t);if(n){var o=this._sceneMap[t];if(null==o&&((o=new J(e)).transition=n.transition),o.id=t,n.libId){var r=this.createComponent(n.libId,n.id);r&&(r.width=e.width,r.height=e.height,o.addComponent(r))}return o}return null},e.prototype.getImageAsset=function(t){if("data"===t.toString().substr(0,4))return e=t,"iOS"===vf.utils.getSystemInfo().os.name&&parseFloat(vf.utils.getSystemInfo().os.version)<9?Xe(e):e;var e,n=this.getAsset(t);if(n){var o=this.data.assets[t];if(o.parent)return n.spritesheet.textures[o.id];switch(o.type){case"image":return n.texture;case"sheet":return n.spritesheet;default:return n}}},e.prototype.getDisplayObject=function(t,e){if(null!=t){if("this"===t.toString().substr(0,4)&&e&&e.parent instanceof y){var n=t.split("#");n.shift();for(var o=e.parent;n.length>0&&o;){var r=n.shift();o=o.getChildById(r)}return o||void this.stage.systemEvent.emitError("E0006",[t],"warning")}return this.creategui(t)}},e.prototype.getAsset=function(t){var e=this.data.assets[t];if(void 0!==e&&void 0!==e.id)return e.parent?this.vfResources[e.parent.toString()]:"audio"!==e.type&&"sound"!==e.type||!this.stage.config.vfvars.useNativeAudio?"video"===e.type?e:this.vfResources[e.id.toString()]:this.data.assets[t];this.stage.systemEvent.emitError("E0001",[t],"warning")},e.prototype.loadAllScript=function(t,e,n){return We(this,void 0,void 0,(function(){var o,r,i;return Je(this,(function(a){switch(a.label){case 0:r=0,a.label=1;case 1:return r<e.length?(o=e[r],[4,vf.utils.readFileSync(o.url,{moduleName:o.name}).catch((function(e){t.systemEvent.error(e)}))]):[3,4];case 2:if((i=a.sent())&&(o.complete=!0,i.isFilter&&o.name&&vf.gui.Filter.list.set(o.name,i)),!t||n!==t.sceneTokenID)return[2];a.label=3;case 3:return++r,[3,1];case 4:return this._isLoadScript=!0,this.loadResourceComplete(n),[2]}}))}))},e.prototype.loadAllAsset=function(t,e,n){return We(this,void 0,void 0,(function(){var o=this;return Je(this,(function(r){return e.forEach((function(e){if(void 0!==e.type)if(""!==e.url&&void 0!==e.url||"font"===e.type)if("audio"===e.type&&t.config.vfvars.useNativeAudio)t.systemEvent.emitError("S0004",[e],"warning");else if("video"!==e.type)if("sound"===e.type&&t.config.vfvars.useNativeAudio)t.systemEvent.emitError("S0004",[e.id],"warning");else{if("image"===e.type){var n=o.checkIsGifSource(e.url);!0===n.isGif&&(e.type="gif",e.url=n.validUrl)}o._resources.push(e)}else t.systemEvent.emitError("S0004",[e.id],"warning");else t.systemEvent.emitError("E0001",[e],"warning");else t.systemEvent.emitError("E0001",[e])})),this.loadResources(n),[2]}))}))},e.prototype.checkIsGifSource=function(t){var e=t.split("?")[0],n=e.split("."),o=!1;return"gif"===n[n.length-1]&&(o=!0),{validUrl:e,isGif:o}},e.prototype.initGlobalVariable=function(){if(this.data.global&&(this.stage.variableManager.addVariableConfig(K.GLOBAL_ID,this.data.global),this.stage.variableManager.addVariableToGlobal(this.data.global)),this.vfActions)for(var t=0,e=this.vfActions.length;t<e;t++){var n=this.vfActions[t];if(n&&37===n.type){var o=n;this.stage.variableManager.addVariableDataToGlobal(o.varId,o.variableType,o.value)}}},e.prototype.createComponent=function(t,e){if(void 0===e||""===e)return this.stage.systemEvent.emitError("E0004",[e],void 0,"libId = "+t),null;var n=this.data.components[t],o=null;if(n)switch(n.type){case"custom":o=this.createCustomComponent(t,e),void 0!==n.interactabled&&(o.interactabled=n.interactabled),void 0!==n.style&&(o.style=n.style);break;default:o=this.creategui(t)}return o},e.prototype.creategui=function(t){var e=this.data.components[t];if(!e)return null;var n,o=e.type;try{(n=new(vf.utils.getGuiModule(o))).$stage=this.stage,n instanceof vf.gui.Video&&(n.forceElementDraw=Ye.videoForceElementDraw)}catch(e){throw this.stage.systemEvent.emitError("E0004",[t]),console.log(e),new Error("guiNamespace['"+o+"'] === undefined")}if(n)for(var r in e)if(r in e)switch(r){case"id":n.libId=e[r];break;case"name":n.libName=e[r];break;case"type":case"children":case"animations":case"actions":case"libs":break;default:n[r]=e[r]}return n},e.prototype.createCustomComponentByParent=function(t,e){var n=this.data.components[t];if(n.children)for(var o=0,r=n.children.length;o<r;o++){var i=n.children[o];if("libId"in i&&i.id==e){var a=this.createComponent(i.libId,i.id);if(a)return this.applyDisplayComponentProperty(a,i),a}}return null},e.prototype.createCustomComponent=function(t,e){var n=this.data.components[t],o=new y;if(o.$stage=this.stage,o.name=n.name,o.libId=t,o.id=e,n.props&&(this.stage.variableManager.addVariableConfig(t.toString(),n.props),this.stage.variableManager.addVariableToComponent(o)),n.children)for(var r=0,i=n.children.length;r<i;r++){var a=n.children[r];if("libId"in a){var s=this.data.components[a.libId],c=this.createComponent(a.libId,a.id);c&&(s.type,this.applyDisplayComponentProperty(c,a),o.addChild(c))}}if(n.actionList&&""!==n.actionList){var p=new ge(o,n.actionList);o.actionList=p}else if(void 0!==t){var u=this.getVfsByComponentId(t.toString());if(u){p=new ge(o,u);o.actionList=p}}if(n.animations){var l=this.stage.config.realFPS,h=new Ue(o,n.animations,this.data.fps,l,this.data.animationTemplate);o.animation=h}if(n.script){var f=this.data.assets[n.script.id];if(f){var m=new(vf.utils.getGuiModule(f.name));o.scripts=[m],m.init(o,n.script.style)}}return o},e.prototype.applyDisplayComponentProperty=function(t,e){for(var n in e)if(n in e)switch(n){case"libId":case"type":case"children":case"animations":case"actions":break;default:0===n.indexOf("filter")?this.applyFilter(t,n,e[n]):t[n]=e[n]}},e.prototype.applyFilter=function(t,e,n){for(var o=e.split("."),r=t,i=0,a=o.length;i<a-1;i++){var s=o[i];r&&r[s]&&(r=r[s])}r&&(r[o[o.length-1]]=n)},e.prototype.loadResourceComplete=function(t){if(this._isLoadResource&&this._isLoadScript){if(!this.stage||t!==this.stage.sceneTokenID)return;this.emit("LoadComplete",!0)}},e.prototype.resourcesSort=function(){var t=vf.utils.getSystemInfo().browser;"Safari"===t.name&&parseInt(t.version.split(".")[0])<=9&&this._resources.sort((function(t,e){return"font"===t.type?-1:"font"===e.type?1:0}))},e.prototype.loadResources=function(t){var e=this;this.resourcesSort(),void 0===this._loader&&(this._loader=new vf.Loader);var n=this._loader,o={},r=this._resources;this._loadNum=0;for(var i=0,a=r.length;i<a;i++){var s=r[i];s.id&&n.resources[s.id]||(o[s.url]?o[s.url].push(s.id):"video"!==s.type?("audio"===s.type||"sound"===s.type||"gif"===s.type?n.add(s.id,Ge(s.url,this.data.baseUrl),{loadType:vf.LoaderResource.LOAD_TYPE.XHR,xhrType:"arraybuffer"}):n.add(s.id,Ge(s.url,this.data.baseUrl)),o[s.url]=[s.id]):o[s.url]=[s.id])}var c,p=0,u=0;c=n.onProgress.add((function(t,n){e._loadNum++,e.emit("LoadProgress",[t.progress,e._loadNum,e._resources.length],n)})),p=n.onComplete.add((function(r,i){for(var a in i)e.vfResources[a]=i[a];for(var a in o)for(var s=o[a].shift();o[a].length>0;)e.vfResources[o[a].shift()]=i[s];n.onProgress.detach(c),n.onComplete.detach(p),n.onError.detach(u),e._isLoadResource=!0,e.stage&&t===e.stage.sceneTokenID&&e.loadResourceComplete(t)})),u=n.onError.add((function(t,o,r){-1!==t.message.indexOf("[404]")&&e.stage.systemEvent.emitError("404",[r.url]),n.fails[r.name]||e.stage.systemEvent.emitError("LoadError",[r.url])})),n.load()},e.prototype.getVfsByComponentId=function(t){if(this.vfActions)for(var e=0,n=this.vfActions.length;e<n;e++){var o=this.vfActions[e];if(o&&36===o.type&&o.value===t)return o.execute}},e}(vf.utils.EventEmitter),Ze=function(){function t(t,e,n){this.id=t,this.parent=e,this.status="init"}return t.prototype.load=function(t){if("init"===this.status)return this.onLoad(t),this.status="ready",this.parent.plugs.set(this.id,this),this},t.prototype.release=function(){"init"!==this.status&&(this.onRelease(),this.parent.plugs.delete(this.id),this.parent=null,this.status="init")},t.prototype.onLoad=function(t){},t.prototype.onRelease=function(){},t}(),Qe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),tn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Qe(e,t),e.prototype.onLoad=function(t){var e=this.parent;this.followLine=new vf.gui.FollowLine;var n=this.followLine;return n.role=1===t.role?"T":"S",n.width=e.width,n.height=e.height,e.addChild(n),n.on(vf.gui.Interaction.ComponentEvent.COMPLETE,this.onComplete,this),e.config.systemEvent.on("message",this.onReceipt,this),this},e.prototype.onRelease=function(){var t=this.followLine;this.parent.config.systemEvent.off("message",this.onReceipt,this),t&&(t.off(vf.gui.Interaction.ComponentEvent.COMPLETE,this.onComplete,this),t.offAll(),t.release())},e.prototype.onComplete=function(t,e){this.parent.config.systemEvent.emit("message",{type:"sendSignal",code:"sendSignal",level:"command",data:{name:"boardDraw",val:e}})},e.prototype.onReceipt=function(t){if(t.data&&"sendSignal"===t.code&&this.followLine){var e=this.followLine;"boardDraw"===t.data.name?e.setData(t.data.val):"boardRestore"===t.data.name?e.reset():"boardErase"===t.data.name?e.isErasing=t.data.val:"boardLineColor"===t.data.name&&(e.lineColor=t.data.val)}},e}(Ze),en=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),nn=function(t){function e(e,n,o){var r=t.call(this,e,n,o)||this;return vf.gui.Utils.setInteractiveElement(n,o),r}return en(e,t),e}(Ze),on=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),rn=function(t){function e(e,n,o){return t.call(this,e,n,o)||this}return on(e,t),e.prototype.onLoad=function(){var t;(null===(t=this.parent.app)||void 0===t?void 0:t.renderer).plugins.interaction.autoPreventDefault=!1},e.prototype.onRelease=function(){},e}(Ze),an=function(){},sn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();!function(t){t[t.NONE=0]="NONE",t[t.LOADING=1]="LOADING",t[t.READY=2]="READY",t[t.PLAYING=3]="PLAYING",t[t.PAUSED=4]="PAUSED",t[t.STOP=5]="STOP"}(Ke||(Ke={}));var cn=function(t){function e(e,n,o){var r=t.call(this,n.width,n.height,o.app)||this;r.plugs=new Map,r.targetScene=void 0,r._delayedDisplayId=-1,r.status=Ke.NONE,r._sceneTokenID=-1,r.data=function(t){var e,n;for(var o in"auto"===t.loadMode&&(He()?t.loadMode="single":t.loadMode="all"),t.assets)void 0===(e=t.assets[o]).id&&(e.id=o),e.url=((n=e.url)&&-1!==n.indexOf("magic=image/resize")&&(n=n+"&x-oss-process=image/resize,p_"+Ye.urlImageScale+","+Ye.urlImageAliFormat+"&imageMogr2/thumbnail/!"+Ye.urlImageScale+"p|imageMogr2/format/"+Ye.urlImageTenFormat),n);return t}(e),r.config=n,r.player=o,r.variableManager=new K,r.soundManager=new $(r),new an;var i=r.res=new qe(r);return i.on("LoadComplete",r.loadAssetCompleted,r),i.on("LoadProgress",r.loadProgress,r),r}return sn(e,t),Object.defineProperty(e.prototype,"curSceneId",{get:function(){return this._curSceneId},set:function(t){this._curSceneId!==t&&(this.lastSceneIndex=this.curSceneIndex,this.curSceneIndex=void 0===t?void 0:function(t,e){var n=t.scenes;if(n){if((void 0===e||""===e)&&n[0])return;e=null==e?void 0:e.toString();for(var o=0,r=n.length;o<r;o++)if(n[o].id.toString()===e)return o}}(this.data,t),this._curSceneId=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sceneTokenID",{get:function(){return this._sceneTokenID},enumerable:!1,configurable:!0}),e.prototype.getSystemEvent=function(){return this.config.systemEvent},Object.defineProperty(e.prototype,"systemEvent",{get:function(){return this.config.systemEvent},enumerable:!1,configurable:!0}),e.prototype.getCurScene=function(){return this.curScene},e.prototype.sendToPlayer=function(t){void 0===t.message&&(t.message=""),t.target&&t.target.libId&&(t.message+=", id = "+t.target.id+" , libId = "+t.target.libId),this.player.runtimeLog(t)},e.prototype.start=function(){this.status=Ke.LOADING;var t=this.data,e=ze(t,this.curSceneId);if(void 0===e)throw new Error("vf scene does not exist!");this.curSceneId=e.id,this._sceneTokenID++,this.sceneEmit("SceneLoad",this.curSceneId,this.curSceneIndex,this.lastSceneIndex),this.res.loadData(function(t,e){var n,o=[];if("all"===t.loadMode||void 0===e.assets)for(var r in t.assets)"js"===t.assets[r].type||"video"===t.assets[r].type||t.assets[r].parent||o.push(t.assets[r]);else e.assets.forEach((function(e){if((n=t.assets[e])&&"js"!==n.type)if(n.parent){var r=t.assets[n.parent];-1===o.indexOf(r)&&o.push(r)}else o.push(n)}));return o}(t,e),function(t){var e=[];for(var n in t.assets){var o=t.assets[n];if("js"===o.type){if(void 0===o.name)throw new Error("loader "+o.url+" failed, missing name field");if(o.complete)continue;e.push(o)}}return e}(t),this._sceneTokenID)},e.prototype.pause=function(){this.curScene&&(this.status=Ke.PAUSED,this.curScene.pause(),this.soundManager.pause())},e.prototype.resume=function(){this.curScene&&(this.curScene.resume(),this.soundManager.resume(),this.status=Ke.PLAYING)},e.prototype.reset=function(t){void 0===t&&(t=!0),this.status!==Ke.NONE&&this.status!==Ke.LOADING&&(this.removeScene(!1),this.loadAssetCompleted(t))},e.prototype.removeScene=function(t){this.curScene&&(this.removeChild(this.curScene),this.curScene.dispose(),this.curScene=void 0),t&&this.res.destroyVfResources(),this.variableManager.clear(),this.res.initGlobalVariable(),this.soundManager.clear(),vf.gui.Scheduler.stopAll()},e.prototype.dispose=function(){this.curSceneId=void 0,this.curSceneTransition=void 0,this._sceneTokenID=-1,this.app&&this.app.ticker&&this.app.ticker.stop(),this.releaseAll(),this.removeScene(!0),this.res&&(this.res.removeAllListeners(),this.res.destroy(),this.res=null),this.plugs.forEach((function(t){t.release()}))},e.prototype.switchToSceneId=function(t,e){if(this.status!==Ke.LOADING){this.targetScene=void 0;var n=e;if(void 0===n&&(n=this.geTransitionById(t)),void 0!==n){var o=this.app.view,r=o.width,i=o.height;this.prevTexture=function(t,e,n,o){var r=n||t.view.width,i=o||t.view.height,a=vf.RenderTexture.create({width:r,height:i,scaleMode:vf.SCALE_MODES.LINEAR});return t.renderer.render(e,a),a}(this.app,this.container,r,i)}this.removeScene("all"!==this.data.loadMode),this.curSceneId=t,this.curSceneTransition=n,this.start(),this.syncInteractiveFlag&&(this.syncInteractiveFlag=!1,this.syncInteractiveFlag=!0)}else this.targetScene={sceneId:t,transition:e}},e.prototype.geTransitionById=function(t){var e=ze(this.data,t);return null==e?void 0:e.transition},e.prototype.switchToSceneIndex=function(t,e){var n=function(t,e){var n=t.scenes;if(n&&n[e])return n[e]}(this.data,parseInt(t,0));n&&this.switchToSceneId(n.id,e)},e.prototype.switchToNextScene=function(t){var e=function(t,e){if(t.scenes&&e)for(var n=0,o=t.scenes.length;n<o;n++)if(t.scenes[n].id===e&&n<o-1)return t.scenes[n+1]}(this.data,this.curSceneId);e&&this.switchToSceneId(e.id,t)},e.prototype.switchToPrevScene=function(t){var e=function(t,e){if(t.scenes&&e)for(var n=0,o=t.scenes.length;n<o;n++)if(t.scenes[n].id===e&&n>0)return t.scenes[n-1]}(this.data,this.curSceneId);e&&this.switchToSceneId(e.id,t)},e.prototype.switchToScene=function(t,e){if(t&&this.app){var n=e;this.curScene&&((t.transition||n)&&void 0===n&&(n=t.transition),this.removeChild(this.curScene),this.curScene.dispose()),this.curScene=t,this.curScene.width=this.width,this.curScene.height=this.height,this.addChild(t),n&&this.prevTexture?(o=this,r=this.prevTexture,new U(o,r,n).run()):(this.emit("TransitionStart"),this.emit("TransitionEnd")),this.status=Ke.PLAYING}var o,r},e.prototype.loadAssetCompleted=function(t){var e=this;if(void 0===t&&(t=!0),this.targetScene&&this.targetScene.sceneId!==this._curSceneId)return this.status=Ke.READY,this.switchToSceneId(this.targetScene.sceneId,this.targetScene.transition),void(this.targetScene=void 0);if(t&&this.sceneEmit("LoadComplete",this._curSceneId,this.curSceneIndex,this.lastSceneIndex),this.status=Ke.READY,void 0!==this.curSceneId){var n=this.config.vfvars;n.syncInteractiveFlag&&(this.syncInteractiveFlag=!0,n.role&&(this.syncManager.role=n.role),n.mode&&(this.syncManager.mode=n.mode));var o=this.res.createScene(this.curSceneId,this);o&&this.switchToScene(o,this.curSceneTransition),this.visible=!1,clearTimeout(this._delayedDisplayId),this._delayedDisplayId=setTimeout((function(){e.visible=!0,e.app&&e.app.stage&&e.createPlugs(),t&&e.sceneEmit("ScenComplete",e._curSceneId,e.curSceneIndex,e.lastSceneIndex,e.getVideoList())}),60)}},e.prototype.getVideoList=function(){if(Ye.hideVideo)return[];var t=this.curScene,e=[],n=[];return t&&t.uiChildren&&t.uiChildren[0]&&t.uiChildren[0].uiChildren&&(e=t.uiChildren[0].uiChildren),e.forEach((function(t){"video"===t.libName&&n.push(t)})),n},e.prototype.loadProgress=function(t,e){this.systemEvent.emit("status",{code:"LoadProgress",level:"status",data:t,target:e})},e.prototype.createPlugs=function(){for(var t=0,e=this.config.plugs;t<e.length;t++){var n=e[t],o=i[n.id];if(o)new o(n.id,this,n).load(n)}},e.prototype.sceneEmit=function(t,e,n,o,r){void 0===r&&(r=[]);var i={id:e,index:n,lastIndex:o};r&&r.length>0&&(i.videoList=r),this.systemEvent.emit("status",{code:t,level:"status",data:i})},e}(vf.gui.Stage),pn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),un=function(t){function e(){var e=t.call(this)||this;return e._observers=[],e}return pn(e,t),e.prototype.emit=function(e,n){if(void 0===e)throw new Error("emitEvent ==> "+e+" is undefined");if(void 0===n.code)throw new Error("emitEvent ==> "+e+" args.code is undefined");if(void 0===n.level)throw new Error("emitEvent ==> "+e+" args.level is undefined");return t.prototype.emit.call(this,e,n)},e.prototype.emitExt=function(t,e,n){this.emit(t,{code:t,level:"command",data:e,target:n})},e.prototype.emitError=function(t,e,n,o){void 0===n&&(n="error"),this.error({code:t,level:n,data:e,message:t,target:o})},e.prototype.error=function(t){this.emit("status",t)},e}(vf.utils.EventEmitter),ln=function(){function t(){this.systemEvent=new un,this.PROPERTY_CHANGE=".Property.Changed",this.PROPERTY_SET_ERROR=".Property.SetError"}return t.prototype.on=function(t,e,n){return this.systemEvent.on(t,e,n),this},t.prototype.addListener=function(t,e,n){return this.on(t,e,n)},t.prototype.removeListener=function(t,e,n,o){return this.off(t,e,n,o)},t.prototype.off=function(t,e,n,o){return this.systemEvent.off(t,e,n,o),this},t.prototype.createRandomId=function(){var t=new Array("8","9","A","B");return this.createRandomIdentifier(8,15)+"-"+this.createRandomIdentifier(4,15)+"-8"+this.createRandomIdentifier(3,15)+"-"+t[this.randomIntegerWithinRange(0,3)]+this.createRandomIdentifier(3,15)+"-"+this.createRandomIdentifier(12,15)},t.prototype.getSessionId=function(){var t=new Date;return String(t.getTime())+String(1e3+t.getMilliseconds())+String(Math.floor(9e3*Math.random())+1e3)},t.prototype.propertyChange=function(t){this.systemEvent.emit("state",{code:this.getClassName(this)+this.PROPERTY_CHANGE,level:"status",data:{name:t,value:this[t]}})},t.prototype.propertyError=function(t,e){this.systemEvent.emit("state",{code:this.getClassName(this)+this.PROPERTY_SET_ERROR,level:"error",data:{name:t,value:e}})},Object.defineProperty(t.prototype,"info",{get:function(){return{}},enumerable:!1,configurable:!0}),t.prototype.output=function(t,e){for(var n in console.groupCollapsed(t),e)console.log("%c"+n+":","color: violet;",e[n]);console.groupEnd()},t.prototype.createRandomIdentifier=function(t,e){void 0===e&&(e=61);var n=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],o=[];for(e=e>61?61:e;t--;)o.push(n[this.randomIntegerWithinRange(0,e)]);return o.join("")},t.prototype.randomIntegerWithinRange=function(t,e){return Math.floor(Math.random()*(1+e-t)+t)},t.prototype.getClassName=function(t){var e=/function (.{1,})\(/.exec(t.constructor.toString());return e&&e.length>1?e[1]:""},t}(),hn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),fn=function(t){function e(e){var n=t.call(this)||this;return n._vfvars={},n._plugs=[],n.realFPS=!0,n._container=e.container,n.uuid=vf.utils.uid(),n._id=e.id||n.createRandomId(),n._wmode=e.wmode||"transparent",n._bgcolor=e.bgcolor,n._vfvars=e.vfvars||{},n._width=e.width||320,n._height=e.height||240,n._showFPS=void 0===e.showFPS||Boolean(e.showFPS),n._conversionData=e.conversionData,n._debug=e.debug||!1,n.realFPS=!0===e.realFPS,n}return hn(e,t),Object.defineProperty(e.prototype,"container",{get:function(){return this._container},set:function(t){this._container!==t&&(this._container=t,this.propertyChange("container"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(t){this._id!==t&&(this._id=t,this.propertyChange("id"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(t){this._scaleMode!==t&&(this._scaleMode=t,this.propertyChange("scaleMode"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wmode",{get:function(){return this._wmode},set:function(t){this._wmode!==t&&(this._wmode=t,this.propertyChange("wmode"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bgcolor",{get:function(){return this._bgcolor},set:function(t){this._bgcolor!==t&&(this._bgcolor=t,this.propertyChange("bgcolor"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vfvars",{get:function(){return this._vfvars},set:function(t){this._vfvars!==t&&(this._vfvars=t,this.propertyChange("vfvars"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"plugs",{get:function(){return this._plugs},set:function(t){this._plugs=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this.propertyChange("width"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height!==t&&(this._height=t,this.propertyChange("height"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"showFPS",{get:function(){return this._showFPS},set:function(t){this._showFPS!==t&&(this._showFPS=t,this.propertyChange("showFPS"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"conversionData",{get:function(){return this._conversionData},set:function(t){this._conversionData!==t&&(this._conversionData=t,this.propertyChange("conversionData"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(t){this._debug!==t&&(this._debug=t,this.propertyChange("debug"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"info",{get:function(){return{container:this.container,id:this.id,scaleMode:this.scaleMode,wmode:this.wmode,bgcolor:this.bgcolor,vfvars:this.vfvars,plugs:this.plugs,width:this.width,height:this.height,showFPS:this.showFPS,conversionData:this.conversionData,debug:this.debug}},enumerable:!1,configurable:!0}),e}(ln),mn=function(){function t(){}return t.use=function(t,e){var n;switch(t.extension){case"ttf":n=t.data;break;case"woff":case"woff2":n="url("+t.url+")";break;default:return void e()}if(t.name.match("[0-9]+$"))return console.log("font name cannot be pure number",t.name),void e();var o=window;if(!o.FontFace){console.log("不支持fontFace api");var r=document.createElement("style"),i="@font-face {font-family: '"+t.name+"'; src: url('"+t.url+"');}";return r.appendChild(document.createTextNode(i)),document.head.appendChild(r),void e()}new o.FontFace(t.name,n,{style:"normal"}).load().then((function(t){document.fonts.add(t),e()})).catch((function(t){console.error("addFont failed.Maybe the font you are trying to load is too big ?\n"+t),e(t)}))},t}(),dn={404:{message:" ${0} #404"},LoadError:{message:"加载失败"},S0003:{message:"消息结构错误，当前：(event:${0},data:${1})"},S0004:{message:"使用Native进行播放，忽略音频加载:${0}"},E0001:{message:"资源${0}的必填字段存在未定义"},E0004:{message:"组件 -> 无法创建id(${0})的组件,检查类型。"},E0005:{message:"数据 -> 本地数据无法使用数据转换器(${0})，同目录下必须包含json文件并在线加载。"},E0006:{message:"组件 -> 找不到组件实例: (${0})"},E1001:{message:"vfx -> 不支持这个操作符: (${0})"},E1002:{message:"vfx -> 找不到变量: (${0})"},E1003:{message:"vfx -> 通过变量 (${0}) 找不到数组的序号。"},E1004:{message:"vfx -> 数组不支持这个方法: (${0})"},E1005:{message:"vfx -> 变量不是数组: (${0})"},E1006:{message:"vfx -> 计算表达式的值出错"},E1007:{message:"vfx -> 找不到这个属性: (${0})"},E1008:{message:"vfx -> 常量(${0})不能被赋值。"},E1010:{message:"vfx -> 重复任务：(${0})"},E1011:{message:"vfx -> 任务参数错误"},E1012:{message:"vfx -> 找不到任务"},E1014:{message:"vfx -> 字符串不支持这个方法: (${0})"},E1015:{message:"vfx -> 变量不是字符串: (${0})"}};function vn(t){var e=dn[t.code];return e?function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(null==t)return"";if(void 0===e)return t;var o,r=e.length;1===r&&Array.isArray(e[0])?r=(o=e[0]).length:o=e;for(var i=0;i<r;i++)t=t.replace(new RegExp("\\${"+i+"\\}","g"),o[i]);return t}(e.message,t.data):"This message code["+t.code+"] is not defined. \n JSON = "+JSON.stringify(t)}var yn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),gn=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function a(t){try{c(o.next(t))}catch(t){i(t)}}function s(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))},_n=function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},bn=function(t){function e(e){var n=t.call(this)||this;return n.buildVersion="2.0.4",n.buildInfo="9/13/2021, 5:39:43 PM",n.onError=function(t){},n.onInit=function(){},n.onReady=function(){},n.onSceneLoad=function(t){},n.onSceneLoadProgress=function(t){},n.onSceneCreate=function(t){},n.onMessage=function(t){},n.onDispose=function(){},n.token={},n.option=e,n.config=new fn(e),e.degradeDevice&&(Ye.degradeDevice=e.degradeDevice),function(){var t=vf.utils.getSystemInfo().os,e=parseFloat(t.version)||1;"iOS"===t.name&&e>=14.3?(Ye.urlImageAliFormat="image/format,webp",Ye.urlImageTenFormat="webp"):"iOS"===t.name&&e>=11?(Ye.urlImageAliFormat="",Ye.urlImageTenFormat="null"):"iOS"===t.name?(Ye.urlImageScale=80,Ye.urlImageAliFormat="",Ye.urlImageTenFormat="null",Ye.videoForceElementDraw=!0,Ye.frameRate=12,Ye.resolution=1,Ye.hideVideo=!0):"Android"===t.name&&(Ye.urlImageAliFormat="image/format,webp",Ye.urlImageTenFormat="webp");var n=He();n&&(Ye.urlImageScale=n.scale||80,Ye.urlImageAliFormat=n.format?"image/format,"+n.format:"",Ye.urlImageTenFormat=n.format||"null",Ye.frameRate=n.frameRate||12,Ye.resolution=n.resolution||1,Ye.hideVideo=n.hideVideo||!0,Ye.antialias=n.antialias||!0)}(),n.app=n.createApp(),n.initSystemEvent(),n._readyState="init",vf.Loader.registerPlugin(mn),e.src&&n.play(e.src),n}return yn(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){t&&t.editorVersion?this._data=t.content:this._data=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._readyState},set:function(t){this._readyState=t,this.config.systemEvent.emit("status",{code:t,level:"status",data:t})},enumerable:!1,configurable:!0}),e.prototype.createApp=function(){var t=this.option,e=this.config,n=new vf.Application({backgroundColor:parseInt(e.bgcolor||"0",16),transparent:"transparent"===e.wmode,antialias:!0,resolution:t.resolution||Ye.resolution,forceCanvas:t.forceCanvas,powerPreference:"low-power"}),o=t.frameRate||Ye.frameRate;return n.ticker.maxFPS=o,vf.Ticker.system.maxFPS=o,vf.Ticker.shared.stop(),vf.Ticker.shared.maxFPS=o,vf.gui.TickerShared.maxFPS=o,vf.gui.Utils.debug=t.debug||!1,n},e.prototype.play=function(t){return gn(this,void 0,void 0,(function(){return _n(this,(function(e){switch(e.label){case 0:return"init"!==this._readyState&&"loaded"!==this._readyState&&this.reload(),"string"!=typeof t?[3,2]:[4,this.raceFun(t,this.loadData.bind(this))];case 1:return e.sent(),[3,3];case 2:"object"==typeof t&&(this.data=t,this.loadData(t)),e.label=3;case 3:return[2]}}))}))},e.prototype.playData=function(t,e){e&&(this.config.conversionData=e),this.play(t)},e.prototype.pause=function(){this.stage&&this.stage.pause()},e.prototype.resume=function(){this.stage&&this.stage.resume()},e.prototype.reset=function(){this.stage&&(this.stage.reset(),this.stage.syncInteractiveFlag&&(this.stage.syncInteractiveFlag=!1,this.stage.syncInteractiveFlag=!0))},e.prototype.message=function(t){this.config.systemEvent.emit("onMessage",t)},e.prototype.runtimeLog=function(t){this.onMessage&&this.onMessage(t)},e.prototype.sendToStage=function(t){var e=this.stage;e&&e.receiveFromPlayer&&e.receiveFromPlayer(t)},e.prototype.switchToNextScene=function(t){this.stage&&this.stage.switchToNextScene(t)},e.prototype.switchToPrevScene=function(t){this.stage&&this.stage.switchToPrevScene(t)},e.prototype.switchToSceneId=function(t,e){t=t.toString(),this.stage?this.stage.switchToSceneId(t,e):this.defaultScene={callBack:this.switchToSceneId,params:[t,e]}},e.prototype.switchToSceneIndex=function(t,e){this.stage?this.stage.switchToSceneIndex(t,e):this.defaultScene={callBack:this.switchToSceneIndex,params:[t,e]}},e.prototype.dispose=function(t){if(void 0===t&&(t=!0),"disabled"!==this.readyState){if(this.option=null,this.defaultScene=void 0,this.config.systemEvent.removeAllListeners(),this.token.cancel&&this.token.cancel(),this.token={},this.stage&&this.stage.dispose(),vf.AudioEngine.Ins().dispose(),this.data=void 0,this.app&&this.app.stage){var e=this.app.renderer;e&&e.texture&&(e.texture.destroyTexture(vf.Texture.WHITE,!0),e.texture.destroyTexture(vf.Texture.EMPTY,!0)),this.app.view.width=0,this.app.view.height=0,this.app.destroy(t,{children:!0,texture:!0,baseTexture:!0})}this.stage=void 0,this.app=null,this.onDispose(),this.readyState="disabled"}},e.prototype.initSystemEvent=function(){var t=this.config.systemEvent;t.on("message",this.sendMessage,this),t.on("status",this.onStatus,this)},e.prototype.reload=function(){this.config.systemEvent.removeAllListeners(),vf.AudioEngine.Ins().dispose(),this.stage&&this.stage.dispose(),this.app&&(this.app.view.width=0,this.app.view.height=0,this.app.destroy(!0,{children:!0,texture:!0,baseTexture:!0})),this.stage=void 0,this.data=void 0,this.app=this.createApp(),this.initSystemEvent()},e.prototype.start=function(){return gn(this,void 0,void 0,(function(){var t,e,n,o;return _n(this,(function(r){return this.data&&this.app?(this.emitAudioList(),t=this.config,e=this.data,n=this.config.container,void 0===t.scaleMode&&(t.scaleMode=e.scaleMode||"noScale"),e.height&&e.width&&(t.width=e.width,t.height=e.height),o=vf.gui.Utils.getBoundingClientRect(n),t.width=vf.gui.Utils.formatRelative(t.width,o.width),t.height=vf.gui.Utils.formatRelative(t.height,o.height),this.app.view.style.zIndex="0",n.appendChild(this.app.view),this.stage=new cn(e,this.config,this),vf.gui.Utils.calculateUpdatePlayerSize(n,this.app,this.stage,t.width,t.height,t.scaleMode),this.readyState="ready",this.defaultScene?this.defaultScene.callBack.call(this,this.defaultScene.params[0],this.defaultScene.params[1]):this.stage.start(),t.debug&&(window.vf.STAGELIST=this.stage),[2]):[2]}))}))},e.prototype.emitAudioList=function(){if(this.data){var t=this.data.assets,e=[];if(t)for(var n in t){var o=t[n];o&&"audio"===o.type&&e.push(o.url)}var r={code:"sendAudioList",data:e,level:"info"};this.sendMessage(r)}},e.prototype.loadData=function(t){return gn(this,void 0,void 0,(function(){var e,n,o,r,i=this;return _n(this,(function(a){switch(a.label){case 0:return this.readyState="load",(e=this.data)?e.conversion?"string"!=typeof t?[3,4]:(n=t.split("?")[1]||"v=0",o=t.substr(0,t.lastIndexOf("/"))+"/"+e.conversion+"?"+n,[4,vf.utils.readFileSync(o,{}).catch((function(t){i.onStatus(t)}))]):[3,5]:[3,7];case 1:return a.sent(),[4,new window.VFConversion];case 2:return r=a.sent(),this.data?[4,r.analysis(this.config.conversionData,this.data)]:[2];case 3:return a.sent(),[3,5];case 4:this.onStatus({code:"E0005",level:"error",data:e.conversion}),a.label=5;case 5:return this.readyState="loaded",this.data?[4,this.start()]:[2];case 6:a.sent(),a.label=7;case 7:return[2]}}))}))},e.prototype.raceFun=function(t,e){return gn(this,void 0,void 0,(function(){var n,o,r,i,a=this;return _n(this,(function(s){return n=this.onStatus.bind(this),o=this.token,r=vf.utils.readFileSync(t,{responseType:"json"}).catch((function(t){n(t)})),i=new Promise((function(t){o.cancel=function(){t(void 0)}})),Promise.race([r,i]).then((function(n){a.data=n,e&&e(t)})),[2]}))}))},e.prototype.sendMessage=function(t){this.onMessage(t)},e.prototype.onStatus=function(t){if("LoadProgress"!==t.code&&this.emit("inputLog",t),"error"===t.level||"warning"===t.level)return t.message=vn(t),void(this.onError&&this.onError(t));switch(t.code){case"init":this.onInit&&this.onInit();break;case"ready":this.onReady&&this.onReady();break;case"SceneLoad":this.emit("showLoading"),this.onSceneLoad&&this.onSceneLoad(t);break;case"LoadProgress":this.onSceneLoadProgress&&this.onSceneLoadProgress(t);break;case"ScenComplete":this.emit("hideLoading"),this.onSceneCreate&&this.onSceneCreate(t);break;default:this.onMessage&&this.onMessage(t)}},e}(vf.utils.EventEmitter),Tn=window;void 0===Tn.vf&&(Tn.vf={}),Tn.vf.player={Player:bn},n.d(e,"Player",(function(){return bn}))}])}));